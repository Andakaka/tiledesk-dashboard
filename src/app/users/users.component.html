<p style="margin-top:10px; padding-left:30px" class="navbar-brand">
  {{ "UsersAndGroups" | translate }}
</p>

<div class="main-content" style="padding-top:0px;">
  <div class="container-fluid">
      <ul class="nav nav-pills nav-pills-info custom">
        <li class="active">
          <a href="#pill1" data-toggle="tab">
            {{ "Users" | translate }}
          </a>
        </li>
        <li>
          <a href="#pill2" data-toggle="tab" (click)="goToGroups()">
            {{ "Groups" | translate }}
          </a>
        </li>
      </ul>

    
    <!-- <div class="row">
      <div class="col-md-3" style="padding-left:0px">
        <div class="nav-items" style="margin-top:100px; position: relative;left: -15px;">
          <div class="nav-item">
            <div class="nav-link" style="
              background-color: #039be5!important;
              color: #fff!important;  
              height: 40px;
              padding: 0 12px 0 24px;
              border-radius: 0 20px 20px 0;
              margin-right: 16px;
              position: relative;
              overflow: hidden;
              cursor: pointer;">
              <span style="padding-top: 9px; display: inline-block;"> Utenti</span> 
            </div>
          </div>
          <div class="nav-item">
            <div class="nav-link" style="
              height: 40px;
              padding: 0 12px 0 24px;
              border-radius: 0 20px 20px 0;
              margin-right: 16px;
              position: relative;
              overflow: hidden;
              cursor: pointer;">
              <span style="padding-top: 9px; display: inline-block;"> Gruppi</span> 
            </div>

          </div>
        </div>
      </div> -->

    <div class="row">
      <div class="col-md-12">
        <div class="card" style="min-height: 195px">

          
          <!-- table-responsive -->

          <div class="card-header card-header-custom" data-background-color="" style="">
            <button *ngIf="USER_ROLE !== 'agent'" class="btn btn-info" style="padding: 8px 16px;margin:0px;" (click)="goToAddUser()">
                <span class="icon" style="padding-right:8px">
                  <i class="material-icons">add_circle</i>
                </span>
              {{ "UsersPage.Invites" | translate }}
            </button>

              <div class="pull-right" style="padding: 8px 16px;color: #039be5;font-weight: 500; cursor: pointer" (click)="goToPendingInvitation()"> 
                {{ "UsersPage.PendingInvitation" | translate }} ({{ countOfPendingInvites }})
              </div>
          </div>

          <loading-spinner *ngIf="showSpinner"></loading-spinner>
         
        
          <div *ngIf="!showSpinner" class="card-content">

            <table class="table table-hover">
              <thead>
                <tr>
                  <!-- FOR DEBUG: ID OF THE PROJECT-USER  -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong>
                        Project_User Id
                      </strong>
                    </span>
                  </th> -->

                  <th>
                    <span style="color: #566787">
                      <strong>
                        {{ "UsersPage.User" | translate }}
                      </strong>
                    </span>
                  </th>

                  <th> </th>

                  <th>
                    <span style="color: #566787">
                      <strong>
                        {{ "UsersPage.Role" | translate }}
                      </strong>
                    </span>
                  </th>

                  <!-- <th>
                    <span style="color: #566787">
                      <strong>
                        Email
                      </strong>
                    </span>
                  </th> -->

                  <!-- OLD: AVAILABLE / UNAVAILABLE INDICATOR -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong>
                        {{ "UsersPage.Available" | translate }}
                      </strong>
                    </span>
                  </th> -->

                  <!-- SWITCH BTN AVAILABLE / UNAVAILABLE  -->
                  <th>
                    <span style="color: #566787">
                      <strong>
                        {{ "UsersPage.Available" | translate }}
                      </strong>
                    </span>
                  </th>

                  <!-- FOR DEBUG: USER ID -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong>
                        {{ "UsersPage.UserId" | translate }}
                      </strong>
                    </span>
                  </th> -->

                  <th>
                    <span style="color: #566787">
                      <!-- Actions -->
                      <strong>
                        {{ "UsersPage.Actions" | translate }}
                      </strong>
                    </span>
                  </th>

                </tr>

              </thead>

              <tbody>

                <tr *ngFor="let projectUser of projectUsersList">
                  <!-- FOR DEBUG: ID OF THE PROJECT-USER  -->
                  <!-- <td>
                    {{ projectUser?._id }}
                  </td> -->

                  <td (click)="goToMemberProfile(projectUser?.id_user?._id)" style="cursor:pointer; width:1%;white-space:nowrap; text-align: center">
                      <img style="vertical-align: middle; width: 35px; height: 35px; border-radius: 50%; border: 1px solid #eee;" 
                      class="user-img" src="https://firebasestorage.googleapis.com/v0/b/chat-v2-dev.appspot.com/o/profiles%2F{{projectUser?.id_user?._id}}%2Fphoto.jpg?alt=media" 
                      onerror="this.src='assets/img/no_image_user.png'"/>
            
                  </td>

                  <td> 

                    <span class="tooltipx">
                      <span style="font-weight:400 "> {{ projectUser?.id_user?.firstname }} </span>
                      <span style="text-transform: uppercase; font-weight:400 "> {{ projectUser?.id_user?.lastname }}  </span>

                      <span class="tooltiptext">
                        {{"UsersPage.ViewProfileUser" | translate }} {{projectUser?.id_user?._id}}
                      </span>
                        
                      <span style="display: block; color:#7695a5; font-size: 12px; font-weight: 400">
                        {{ projectUser?.id_user?.email }} 
                      </span>
                    </span>
                        
                  </td>

                  <td (click)="goToMemberProfile(projectUser?.id_user?._id)" style="cursor:pointer">
                    <span class="tooltipx">
                      {{ projectUser?.role | translate}}
                      <span class="tooltiptext">
                        {{"UsersPage.ViewProfileUser" | translate }} {{projectUser?.id_user?._id}}
                      </span>
                    </span>
                  </td>

                  <!-- <td (click)="goToMemberProfile(projectUser?.id_user?._id)" style="cursor:pointer">
                    <span class="tooltipx">
                      {{ projectUser?.id_user?.email }}
                      <span class="tooltiptext">
                        {{"UsersPage.ViewProfileUser" | translate }} {{projectUser?.id_user?._id}}
                      </span>
                    </span>
                  </td> -->

                  <!-- OLD: AVAILABLE / UNAVAILABLE INDICATOR -->
                  <!-- <td (click)="goToMemberProfile(projectUser?.id_user?._id)" style="cursor:pointer">
                    <i *ngIf="projectUser?.user_available === true" class="material-icons" style=" font-size: 16px; color: #1eb848; margin-right:0px">fiber_manual_record</i>
                    <i *ngIf="projectUser?.user_available === false" class="material-icons" style=" font-size: 16px; color: #cac9c9; margin-right:0px">fiber_manual_record</i>
                  </td> -->
                  

                  <!-- SWITCH AVAILABLE / UNAILABLE  -->
                  <td>
                    <label class="switch" style="margin-bottom: 0px;">
                      <input type="checkbox" (click)="changeAvailabilityStatus(projectUser?.user_available, projectUser?._id)" [checked]="projectUser?.user_available === true">
                      <span class="slider round"></span>
                    </label>
                  </td>


                  <!-- FOR DEBUG: USER ID -->
                  <!-- <td (click)="goToMemberProfile(projectUser?.id_user?._id)">
                    {{ projectUser?.id_user?._id }}
                  </td> -->

                  <!-- ACTIONS -->
                  <td class="td-actions text-right">
                    <span *ngIf="projectUser?.role !== 'owner' && CURRENT_USER_ID !== projectUser?.id_user?._id">
                      <button type="button" rel="tooltip" title="{{ 'UsersPage.tootipEditUser' | translate }}" class="btn btn-primary btn-simple btn-xs"
                        (click)='goToEditUser(projectUser?._id)'>
                        <i class="material-icons">edit</i>
                      </button>
                      <button type="button" rel="tooltip" title="{{ 'UsersPage.tootipDeleteUser' | translate }}" class="btn btn-danger btn-simple btn-xs"
                        (click)='openDeleteModal(projectUser?._id, projectUser?.id_user?._id, projectUser?.id_user?.firstname, projectUser?.id_user?.lastname)'>
                        <i class="material-icons">close</i>
                      </button>
                    </span>
                  </td>

                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>

<!-- ============ USERS DELETE MODAL ============ -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':display}" style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background-color:#ff5252;">
        <button type="button" class="close" aria-label="Close" (click)="onCloseModal()">
          <span aria-hidden="true" style="color: #fff">&times;</span>
        </button>

        <h4 class="modal-title" style="color: #fff">
          <i class="material-icons" style="vertical-align: middle">report_problem</i>
          <span style="vertical-align: middle; padding-left:8px">
            {{ "UsersPage.modalDeleteUser" | translate }}
          </span>
        </h4>

        <h4 class="modal-title" style="color: #fff; padding-top:10px; font-size: 1.1em;">
          <!-- Il membro con ID:  -->
          {{ "UsersPage.TheMemberWithId" | translate }}
          <code>{{user_id}}</code>
          {{ "UsersPage.WillBeRemoved" | translate }}
        </h4>

      </div>

      <div class="modal-body">
        <p style="color:rgba(0,0,0,0.87)">
          {{ "UsersPage.AreYouSure" | translate }}
          <b>{{user_firstname}} {{user_lastname }} </b> 
          {{ "UsersPage.FromTheProject" | translate }}?
        </p>
      </div>

      <div class="modal-footer">
        <button class="btn btn-white" (click)="onCloseModal()" style="padding:12px 16px;">
          <!-- Annulla -->
          {{ "UsersPage.Cancel" | translate }}
        </button>
        <!-- Confirm -->
        <button class="btn btn-danger" (click)="onCloseDeleteModalHandled()">
          {{ "UsersPage.modalDeleteUser" | translate }}
        </button>
      </div>


    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>