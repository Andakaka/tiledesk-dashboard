<!-- <div class="navbar-brand" style="z-index: -1;margin-top:10px; padding-left:30px">
    <i class="material-icons" style="vertical-align: middle !important; cursor: pointer;" (click)="goBack()">keyboard_arrow_left</i>
    {{ "Hours" | translate }}
</div> -->
<p style="margin-top:10px; padding-left:30px" class="navbar-brand">
  {{ "Hours" | translate }}
</p> 
<div class="main-content" style="padding-top:0px">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">

        <div class="card" style="padding-bottom: 25px;">
          <div class="card-content" style="padding-top: 25px;">

            <div class="row" >
              <div class="col-md-6">
                <div class="oaerror info" >
                  <p style="color: #566787; font-weight:500; font-size: 14px; ">
                    {{ "HoursPage.ActivateTimetables" | translate }} 
                  </p>
              
                  <!-- [ngClass]="{'chekboxCustomHeight' : isActiveOperatingHours == false }" -->
                  <label class="container" for="hoursActive" style="margin-left: 0px; margin-bottom: 6px;">
                    {{ "HoursPage.OpeningHoursActivated" | translate }} 
                    <!-- <span *ngIf="isActiveOperatingHours === true "> {{ "HoursPage.OpeningHoursActivated" | translate }} </span>
                    <span *ngIf="isActiveOperatingHours === false"> {{ "HoursPage.OpeningHoursDeactivated" | translate }} </span> -->
                    <input type="checkbox" id="hoursActive"  (change)="onChange($event)" [checked]="isActiveOperatingHours"/>
                    <span class="checkmark" style="margin-top: 8px;"></span>
                  </label>

                </div>
              </div>

              <div class="col-md-6">
              
                <div class="oaerror info" >
                  <div class="row">             
                    <div class="col-sm-12"> 

                      <p style="color: #566787; font-weight:500; font-size: 14px; margin-bottom: 16px">
                        <!-- The project timezone is setted to: -->
                        {{ "HoursPage.TheProject" | translate }}<span class="tooltipx">timezone <span class="tooltiptext">{{ "HoursPage.CurrentTimezone" | translate }} (UTC {{ timezoneUTCOffsetForTooltip}}) {{timezoneNameForTooltip}}</span> </span> {{ "HoursPage.IsSettedTo" | translate }}          
                      </p>

                      <!-- // note: with ngModel is set the previously selected value on the select option dropdown -->
                      <ng-select #selectElem class="custom" [(ngModel)]="current_prjct_timezone_name" (change)="setSelectedTimeZone()" style="margin-bottom: 6px;">
                        <ng-option *ngFor="let tz of timezone_NamesAndUTC_list" [value]="tz.value" style="height: 16px !important">
                          {{ tz.tz }}
                        </ng-option>
                      </ng-select>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-12">
                <div class="card">

                  <div class="card-content table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>
                            <span style="color: #566787">
                              <strong>
                                {{ "HoursPage.Day" | translate }} 
                              </strong>
                            </span>
                          </th>
                          
                          <th colspan="2">
                            <span style="color: #566787">
                              <strong>
                                {{ "HoursPage.Status" | translate }} 
                              </strong>
                            </span>
                          </th>

                          <!-- // FOR DEBUG -->
                          <!-- <th>
                            <span style="color: #566787">
                              <strong>
                                Hours
                              </strong>
                            </span>
                          </th> -->
                          
                          <th style="padding-left: 25px;">
                            <span style="color: #566787">
                              <strong>
                                {{ "HoursPage.Morning" | translate }} 
                              </strong>
                            </span>
                          </th>
                            
                          <th></th>

                          <th style="padding-left: 25px;">
                            <span style="color: #566787">
                              <strong>
                                {{ "HoursPage.Afternoon" | translate }} 
                              </strong>
                            </span>
                          </th>
                              
                        <tr>
                      </thead>

                      <tbody>
                        <tr *ngFor="let d of days">
                          
                          <td>
                            <span style="color: #566787; font-weight: 500">
                              {{ d.weekday | translate}}
                            </span> 
                          </td>

                          <td style="white-space: nowrap; width: 1%; padding-bottom: 6px;">
                            <label class="switch" style="margin-bottom: 0px;">
                              <input type="checkbox" (change)="onChangeOpenedClosedStatus($event, d?._id, d?.weekday)"
                                [checked]="d?.isOpen == true"  >
                              <span class="slider round"></span>
                            </label>
                          </td>
                            
                          <td>
                            <span *ngIf="d.isOpen" style="background-color: #4caf50; color: white; padding: 4px 8px; border-radius: 3px; letter-spacing: 1px; font-size: 0.8em; " >
                              <!-- APERTO -->
                              {{ "HoursPage.Opened" | translate }} 
                            </span>
                            <span *ngIf="!d.isOpen" style="background-color: #f44336; color: white; padding: 4px 8px; border-radius: 3px; letter-spacing: 1.3px; font-size: 0.8em; ">
                              <!-- CHIUSO -->
                              {{ "HoursPage.Closed" | translate }} 
                            </span>
                          </td>
      
                          <!-- // FOR DEBUG -->
                          <!-- <td>
                            <tr *ngFor="let oh of d.operatingHours">
                              <td> {{ oh.start }} </td>
                              <td> {{ oh.end }}  </td>
                            </tr>
                          </td> -->

                          <!-- AM HOURS -->
                          <td style="padding-top: 6px; padding-bottom: 6px;">
                            <!-- AM START HOUR -->
                            <button [disabled]="d.isOpen != true"  [ngClass]="{'disabled' : d.isOpen != true}" type="button" rel="tooltip" title="edit hour" class="btn btn-primary btn-simple btn-xs"
                              (click)='openAmStart(d?._id)' style="padding-right: 4px;">
                              <span class="edithours_btnlabel">
                                <!-- Opening -->
                                <!-- From -->
                                {{ "HoursPage.From" | translate }} 
                              </span> 
                              <i class="material-icons">schedule</i>
                            </button>

                            <input [disabled]="d.isOpen != true" (input)="onChangeAmStartFromArrow($event.target.value, d?._id)"  [ngClass]="{'disabled' : d.isOpen != true}" type="time" value="{{ d.operatingHoursAmStart }}">

                            <br class="newline">
  
                            <!-- AM END HOUR -->
                            <button [disabled]="d.isOpen != true"  [ngClass]="{'disabled' : d.isOpen != true}" type="button" rel="tooltip" title="edit hour" class="btn btn-primary btn-simple btn-xs"
                              (click)='openAmEnd(d?._id)' style="padding-right: 4px;">
                              <!-- <span class="edithours_btnlabel">Closing</span>  -->
                              <span class="edithours_btnlabelTo" [ngClass]="{'it_custom' : browser_lang == 'it'}">
                                <!-- To -->
                                {{ "HoursPage.To" | translate }} 
                              </span>
                              
                              <i class="material-icons">schedule</i>
                            </button>
                            <input [disabled]="d.isOpen != true" (input)="onChangeAmEndFromArrow($event.target.value, d?._id)" [ngClass]="{'disabled' : d.isOpen != true}" type="time" value="{{ d.operatingHoursAmEnd }}">
                          </td>
                            
                          <!-- CLOSE / OPEN AFTERNOON TIMES -->
                          <td style="white-space: nowrap; width: 1%;">
                            <!-- placeholder button - is dispalyed when the day is closed  -->
                            <button *ngIf="d?.isOpen === false" type="button" rel="tooltip" title="remove second interval" class="btn btn-default btn-simple btn-xs  btn-circle close_pm disabled"
                              style="padding-left: 1px;padding-top: 1px; padding-right: 4px">
                              <i class="material-icons"  style="font-size: 12px; font-weight: 600; padding-bottom: 2px">
                                clear
                              </i>
                            </button>

                            <button *ngIf="d?.isOpenPm === true && d?.isOpen === true" type="button" rel="tooltip" title="remove second interval" class="btn btn-danger btn-simple btn-xs  btn-circle close_pm"
                              (click)="close_Pm(d?._id)" style="padding-left: 1px;padding-top: 1px; padding-right: 4px">
                              <i class="material-icons"  style="font-size: 12px; font-weight: 600; padding-bottom: 2px">
                                clear
                              </i>
                            </button>

                            <button *ngIf="d?.isOpenPm === false && d?.isOpen === true" type="button" rel="tooltip" title="add second interval" class="btn btn-success btn-simple btn-xs  btn-circle open_pm"
                              (click)="open_Pm(d?._id)" style="padding-left: 1px;padding-top: 1px; padding-right: 4px">
                              <i class="material-icons"  style="font-size: 12px; font-weight: 600; padding-bottom: 2px">
                                add
                              </i>
                            </button>
                          </td>

                          <!-- PM HOURS -->
                          <td style="padding-top: 6px; padding-bottom: 6px;">
                            <!-- PM START HOUR -->
                            <button  [disabled]="d.isOpen != true || d.isOpenPm == false" type="button" rel="tooltip" title="edit hour" class="btn btn-primary btn-simple btn-xs"
                              [ngClass]="{'disabled' : d.isOpen != true || d.isOpenPm == false}" (click)='openPmStart(d?._id)' style="padding-right: 4px;">
                                
                              <span class="edithours_btnlabel">
                                    <!-- From  -->
                                {{ "HoursPage.From" | translate }} 
                              </span>
                              <i class="material-icons">schedule</i>
                            </button>
                            <input [disabled]="d.isOpen != true || d.isOpenPm == false" (input)="onChangePmStartFromArrow($event.target.value, d?._id)" 
                                  [ngClass]="{'disabled' : d.isOpen != true || d.isOpenPm == false}" type="time" value="{{ d.operatingHoursPmStart }}">

                              <br class="newline">

                              <!-- PM END HOUR -->
                              <button [disabled]="d.isOpen != true || d.isOpenPm == false"  type="button" rel="tooltip" title="edit hour" class="btn btn-primary btn-simple btn-xs"
                                [ngClass]="{'disabled' : d.isOpen != true || d.isOpenPm == false}" (click)='openPmEnd(d?._id)' style="padding-right: 4px;">
  
                                <span class="edithours_btnlabelTo" [ngClass]="{'it_custom' : browser_lang == 'it'}">
                                  <!-- To -->
                                  {{ "HoursPage.To" | translate }} 
                                </span>
                                <i class="material-icons">schedule</i>
                              </button>
                            <input [disabled]="d.isOpen != true || d.isOpenPm == false" (input)="onChangePmEndFromArrow($event.target.value, d?._id)" 
                              [ngClass]="{'disabled' : d.isOpen != true || d.isOpenPm == false}" type="time" value="{{ d.operatingHoursPmEnd }}">
                          </td>

                        </tr>
                      </tbody>
                    </table>
                  </div>

                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-12">
                <button class="btn btn-success" (click)="updateProject()">
                  {{ "HoursPage.UpdateHours" | translate }}
                </button>

                <!-- // TEST THE OPERATORS  -->
                <!-- <button class="btn btn-success" (click)="testAvailableProjectUserConsideringProjectOperatingHours()">
                  TEST AVAILABLE
                </button> -->
              </div>
            </div>

            <!-- // TO TEST OPERATING HOURS BY INIECTING THE JSON IN THE INPUT FIELD -->
            <!-- <label  class="col-sm-2" style="height: 36px; padding-top: 7px; padding-left: 16px; padding-right: 16px; text-align: right;">
              + {{ "Hours" | translate }}
            </label>
            <div class="col-sm-10">
              <input [(ngModel)]="operatingHours" class="" type="text" placeholder='{{ "Hours" | translate }}'>
            </div> -->
  
          </div>
          <!-- // BUTTON TO TEST OPERATING HOURS BY INIECTING THE JSON IN THE INPUT FIELD -->
          <!-- <div style="padding-left:25px" class="col-sm-10 col-sm-offset-2">
            <button class="btn btn-success" (click)="updateProjectOperatingHours()">
              {{ "HoursPage.UpdateHours" | translate }}
            </button>   
          </div> -->

        </div>
      </div>
    </div>
  </div>
</div>

 <!-- ============ INFO MODAL: UPDATING OPERATING HOURS IN PROGRESS ============ -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayModalUpdatingOperatingHours}" style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" aria-label="Close" (click)="closeModalOperatingHours()">
          <span aria-hidden="true">&times;</span>
        </button>

        <h4 class="modal-title">
          {{ "HoursPage.UpdateHours" | translate }}
          <!-- <code>{{id_toDelete}}</code> -->
        </h4>
      </div>

      <div class="modal-body" style="padding-top:15px; padding-bottom:15px">
        <span *ngIf="SHOW_CIRCULAR_SPINNER">
          <div  class="loader" style="top:25%;">
            <svg class="circular" viewBox="25 25 50 50">
              <circle class="path" cx="50" cy="50" r="15" fill="none" stroke-width="2" stroke-miterlimit="10"/>
            </svg>

          </div>
          <p style="margin-top: 60px; text-align: center; color: #566787; font-weight: 500">
            {{ "HoursPage.Processing" | translate }}
          </p>
        </span>

        <!-- IF THERE IS NO ERROR -->
        <span *ngIf="!SHOW_CIRCULAR_SPINNER && !UPDATE_HOURS_ERROR ">
          <div style="text-align: center">
            <i class="material-icons" style="color:#70b665">done</i>
            <p style="color:#70b665; font-weight: 500">
              {{ "HoursPage.Completed" | translate }}
            </p> 
          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
            {{ "HoursPage.OperatingHoursSuccessfullyUpdated" | translate }}
          </p>
        </span>

        <!-- IF THERE IS AN ERROR -->
        <span *ngIf="!SHOW_CIRCULAR_SPINNER && UPDATE_HOURS_ERROR">
          <div style="text-align: center ">
            <i class="material-icons" style="color:#ff5252">report_problem</i>
            <p style="color:#ff5252; font-weight: 500">
              {{ "HoursPage.Error" | translate }}
            </p> 
          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
            <span *ngIf="!TIMEZONE_NAME_IS_NULL">{{ "HoursPage.AnErrorHasOccurred" | translate }}</span> <span *ngIf="TIMEZONE_NAME_IS_NULL">{{ "HoursPage.ErrorSelectTheProjectTimezone" | translate }}</span>
          </p>
        </span>
      </div>

      <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-info" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="closeModalOperatingHoursHandler()" style="padding:12px 16px;">
          {{ "HoursPage.Continue" | translate }}
        </button>
      </div>

    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>