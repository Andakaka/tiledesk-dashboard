
 <p style="margin-top:10px; padding-left:30px" class="navbar-brand">
   {{ "History" | translate }}
 </p> 

<div class="main-content" style="padding-top:0px">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
  

        <div class="card">
            <!-- data-background-color="red" -->
          <div class="card-header" style="background-color:#ffffff; padding: 8px;">
            <!-- <h4 class="title" style="color: #566787">Search Panel</h4>
            <p class="category">Here is a subtitle for this table</p> -->

            <!-- NEW NK START -->

              <div class="row">
                <div class="col-md-12">
                  <div class="input-group" id="adv-search">
                    <!-- FULL TEXT -->   <!--  -->
                    <input [(ngModel)]="fullText" class="form-control" type="text" 
                    style="margin-top: -8px; padding-left: 12px;"
                    placeholder="{{ 'HistoryPage.ContainsTheWords' | translate }}" (focus)="focusOnFullText()"/>

                    <div class="input-group-btn">
                      <div class="btn-group" role="group">
                          <div class="dropdown dropdown-lg">

                              <!-- ADVANCED OPTIONS -->
                              <button #advancedoptionbtn type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" (click)=advancedOptions()>
                                <span class="caret"></span>
                              </button>
                              <div class="dropdown-menu dropdown-menu-right" role="menu">
                                  <form class="form-horizontal" role="form">
                                    <div class="form-group">
                                      <label  class="col-sm-12" style="text-align: left">
                                          {{ 'HistoryPage.FilterByDepartment' | translate }}
                                      </label>
                                      <!-- class="form-control" -->
                                      <div class="col-sm-12">
                                        <input name="deptName" [(ngModel)]="deptName" 
                                        style="
                                        padding-left: 6px;
                                        height: 34px; 
                                        font-size: 14px; 
                                        border-radius: 4px; 
                                        border: 1px solid #CCC; width: 100%;"  
                                        type="text" />
                                        <!-- <select class="form-control">
                                            <option value="0" selected>All Snippets</option>
                                            <option value="1">Featured</option>
                                            <option value="2">Most popular</option>
                                            <option value="3">Top rated</option>
                                            <option value="4">Most commented</option>
                                        </select> -->
                                      </div>
                                    </div>
                                    <div class="form-group">
                                      <label for="contain" class="col-sm-12" style="text-align: left">
                                          {{ 'HistoryPage.DateRange' | translate }}
                                      </label>
                                      <div class="col-sm-6" >
                                          <my-date-picker name="mydate" [options]="myDatePickerOptions"
                                          [(ngModel)]="startDate" ></my-date-picker>
                                      </div>
                                      <!-- padding-left: 15px; -->
                                      <div class="col-sm-6" style="">
                                          <my-date-picker name="mydate" [options]="myDatePickerOptions"
                                          [(ngModel)]="endDate" ></my-date-picker>
                                      </div>
                                    </div>
                                    <!-- <div class="form-group">
                                      <label for="contain">Contains the words</label>
                                      <input class="form-control" type="text" />
                                    </div> -->
                                    <button #onbottomsearchbtn [disabled]="!deptName && !startDate && !endDate && !fullText" type="submit" class="btn btn-info" (click)="search()">
                                      <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                                    </button>
                                  </form>
                              </div>
                          </div>

                          <!-- SEARCH BUTTON NEAR THE CARET  -->
                          <button #ontopsearchbtn [disabled]="!deptName && !startDate && !endDate && !fullText" type="button" class="btn btn-info" (click)="search()">
                            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                          </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <!-- </div> -->
            <!-- NEW NK END  -->

           
        
              <!-- <form #myForm="ngForm" novalidate>
                <div class="row" style="margin-bottom: 15px;">
                      <label style="padding-top: 8px; padding-right: 15px; text-align: right; color: #566787" class="col-sm-2">
                          Full Text 
                      </label>
                      <div class="col-sm-2">
                          <input name="fullText" [(ngModel)]="fullText" class="" type="text"  
                          style=" height: 34px;
                          font-size: 14px; padding-left: 6px; border-radius: 4px; border: 1px solid #CCC;  padding-right:0px;
                          border-right: none; border-radius: 4px 0px 0px 4px; width: 100%;">
                       
                      </div>
                      <div class="col-sm-2">
                          <button class="" (click)="search()" 
                          style="cursor:pointer;  border: 1px solid #4caf50 ;  height:34px; border-radius: 4px; background-color:#4caf50;
                          border-left:none;  border-radius: 0px 4px 4px 0px; ">Search</button>
                      </div>
                      
                      <div class="col-sm-2" style="height: 34px;">
                          <a (click)="toggle()" style="cursor:pointer; ">Advanced</a>
                      </div>
                  </div>

                  <div *ngIf="show" @ngIfAnimation>
                      <div @easeInOut>
                  
                      <div class="row" style="margin-bottom: 15px;">
                      <label style="padding-top: 8px; padding-right: 15px; text-align: right; color: #566787" class="col-sm-2">
                          Department 
                      </label>
                      <div class="col-sm-2">
                          <input name="deptName" [(ngModel)]="deptName" class="" type="text"  style="height: 34px;
                          font-size: 14px; padding-left: 6px; border-radius: 4px; border: 1px solid #CCC; padding-right:0px; width: 100%;">
                      </div>
                      </div>

                      <div class="row">
                        <label style="padding-top: 8px; padding-right: 15px; text-align: right; color: #566787" class="col-sm-2">
                            Date Range 
                        </label>
                        <div class="col-sm-2" >
                            <my-date-picker name="mydate" [options]="myDatePickerOptions"
                            [(ngModel)]="startDate" ></my-date-picker>
                        </div>
                        <div class="col-sm-2" style="padding-left: 15px;">
                            <my-date-picker name="mydate" [options]="myDatePickerOptions"
                            [(ngModel)]="endDate" ></my-date-picker>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-10 col-md-offset-2" >
                          <button [disabled]="!deptName && !startDate && !endDate" class="btn btn-success" (click)="search()" style="padding-top: 6px; padding-bottom: 6px;">
                            Search
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
              </form> -->
        
            
          </div>

            <loading-spinner *ngIf="showSpinner"></loading-spinner>
            <div  *ngIf="!showSpinner" class="card-content table-responsive">
 

              <table class="table table-hover">
                <thead class="text">
                  <tr>
               
                    <th></th>
 
                    <!-- ===== REQUEST ID ===== -->
                    <!-- <th>
                      <span style="color: #566787">
                        <strong>
                          Id
                        </strong>
                      </span>  
                    </th> -->

                    <!-- ===== DEPARTMENT NAME ===== -->
                    <th>
                      <span style="color: #566787">
                        <strong>
                          <strong>{{ 'VisitorsPage.Department' | translate }}</strong>
                        </strong>
                      </span>  
                    </th>

                    <!-- ===== REQUESTER ===== -->
                    <th>
                      <span style="color: #566787">
                        <strong> 
                          {{ 'HistoryPage.Requester' | translate }}
                        </strong>
                      </span>
                    </th>

                    <!-- ===== REQUESTER ID * FOR DEBUG * ===== -->
                    <!-- <th>
                      <span style="color: #566787">
                        <strong> Requester Id </strong>
                      </span>
                    </th> -->

                    <!-- ===== REQUEST FIRST TEXT ===== -->
                    <th>
                      <span style="color: #566787">
                        <strong> 
                          {{ 'HistoryPage.Message' | translate }}
                        </strong>
                      </span>
                    </th>

                    <!-- ===== SERVED BY ===== -->
                    <th>
                      <span style="color: #566787">
                        <strong> 
                          {{ 'HistoryPage.ServedBy' | translate }}
                        </strong>
                      </span>
                    </th>
                   
                    <!-- ===== RATING ===== -->
                    <th>
                      <span style="color: #566787">
                        <strong> 
                          {{ 'HistoryPage.Rating' | translate }}
                        </strong>
                      </span>
                    </th>
 
                    <!-- ===== MEMBERS ===== -->
                    <!-- <th>
                      <span style="color: #566787">
                        <strong> Membri </strong>
                        </span>
                    </th> -->

                    <!-- ===== PUBLISHED ===== -->
                    <th>
                      <span style="color: #566787">
                        <strong> 
                        {{ 'HistoryPage.Published' | translate }}
                        </strong>
                      </span>
                    </th>
    
                  </tr>
                </thead>

               <tbody>

                <!-- ===== IF THERE ISN'T HISTORY REQUEST ===== -->
                <tr *ngIf="requestList && requestList.length === 0"> 
                  <td colspan="6" style="text-align: center; padding-top: 16px; cursor: pointer">

                    <p style="font-size:1em; color:#999999; font-weight: 400">
                      {{ 'HistoryPage.NoRequests' | translate }}
                    </p>
                  </td>
                </tr> 
 
                 <tr *ngFor="let request of requestList">
                   
                  <td style="text-align:center">
 
                    <span (click)='goToRequestMsgs(request?.request_id)'>
                       <!-- pull-right -->
                       <button class="btn btn-default btn-visibility-custom">
                         <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                       </button>
                    </span>
                     
                  </td>
                   
                  <!-- ===== REQUEST ID ===== -->
                   <!-- <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                     <p style="font-size:0.8em;" >
                       {{ request?.recipient }}
                     </p>
                  </td> -->

                  <!-- ===== DEPARTMENT NAME ===== -->
                  <td>
                      <p style="font-size:0.9em">
                        {{ request?.departmentid?.name }}
                      </p>
                  </td>

                  <!-- ===== REQUESTER FULL NAME ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" rel="tooltip" title="{{ request?.requester_id }}">
                    <p style="font-size:0.9em">
                      {{ request?.requester_fullname }}
                    </p>
                  </td>

                  <!-- ===== REQUESTER ID * FOR DEBUG * ===== -->
                  <!-- <td>
                    <p style="font-size:0.8em">
                      {{ request?.requester_id }}
                    </p>
                  </td> -->

                  <!-- ===== REQUEST FIRST TEXT ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                    <p style="font-size:0.9em;" [innerHTML]="getRequestText(request?.first_text)">
                    </p>
                  </td>
 
                  <!-- ===== SERVED BY ===== -->
                  <!-- <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" >
                    <span *ngFor="let m of request?.members_array"  style="font-size:0.8em;">
                      <span *ngIf="m !== request?.requester_id && m !== 'system' && m !== currentUserID"> 
                        <p class="member" (click)="goToMemberProfile( m )" [innerHTML]="members_replace( m )" style="padding-top:1px; padding-bottom:1px; cursor: pointer;">  </p>
                      </span> 
                      <p *ngIf="m === currentUserID" style="padding-top:1px; padding-bottom:1px;"> 
                        - <strong> 'ME' </strong>
                      </p>
                    </span>
                  </td> -->
                  <td></td>
 
                  <!-- ===== RATING ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" >
                    <p *ngIf="request?.rating" style="font-size:0.8em;">
                        {{ request?.rating }} / 5
                    </p>
                    <p *ngIf="!request?.rating" style="font-size:0.8em;">
                        - / 5
                    </p>
                  </td>
 
                  <!-- ===== LIST OF MEMBERS ===== -->
                  <!-- <td (click)='openViewMsgsModal(request?.recipient)' style="cursor:pointer">
                    <p style="font-size:0.8em; min-width: 220px;"  [innerHTML]="request?.members_as_string"></p>
                  </td> -->

                  <!-- ===== PUBLISHED ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                    <p style="font-size:0.9em">
                      <!-- {{ request?.timestamp | date: 'd/M/y HH:mm:ss'}} -->
                      <!-- {{ request?.request_date_fromnow }} -->
                      <!-- {{ request?.created_on | date: 'd/M/y HH:mm:ss' }} -->
                      {{ request?.created_on | amTimeAgo }}
                    </p>
                  </td>

                </tr>
              </tbody>
            </table>
          </div> <!-- ./ card-content table-responsive -->
        </div> <!-- ./ card -->
      </div> <!-- ./ col-md-12 -->
    <div> <!-- ./ row -->
  
  </div> <!-- ./ container-fluid -->
</div> <!-- ./ main-content -->

  