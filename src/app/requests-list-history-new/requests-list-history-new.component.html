
 <p style="margin-top:10px; padding-left:30px" class="navbar-brand">
   {{ "History" | translate }}
 </p> 

<div class="main-content" style="padding-top:0px">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
  

        <div class="card">
            <!-- data-background-color="red" -->
          <div class="card-header" style="background-color:#ffffff; padding: 8px;">
            <!-- <h4 class="title" style="color: #566787">Search Panel</h4>
            <p class="category">Here is a subtitle for this table</p> -->

            <!-- NEW NK START -->

              <!-- <div class="row">
                <div class="col-md-12">
                  <div class="input-group" id="adv-search">

                    <input [(ngModel)]="fullText" class="form-control" type="text" 
                    style="margin-top: -8px; padding-left: 12px;"
                    placeholder="{{ 'HistoryPage.ContainsTheWords' | translate }}" (focus)="focusOnFullText()"/>

                    <div class="input-group-btn">
                      <div class="btn-group" role="group">
                          <div class="dropdown dropdown-lg">

                              <button #advancedoptionbtn type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" (click)=advancedOptions()>
                                <span class="caret"></span>
                              </button>
                              <div class="dropdown-menu dropdown-menu-right" role="menu">
                                  <form class="form-horizontal" role="form">
                                    <div class="form-group">
                                      <label  class="col-sm-12" style="text-align: left">
                                          {{ 'HistoryPage.FilterByDepartment' | translate }}
                                      </label>
  
                                      <div class="col-sm-12">
                                                <ng-select name="dept" [(ngModel)]="selectedDeptId">
                                            <ng-option *ngFor="let dept of departments" [value]="dept._id" >{{dept.name}}</ng-option>
 
                                        </ng-select>
                                      </div>
                                    </div>
                                    <div class="form-group">
                                      <label for="contain" class="col-sm-12" style="text-align: left">
                                          {{ 'HistoryPage.DateRange' | translate }}
                                      </label>
                                      <div class="col-sm-6" >
                                          <my-date-picker name="mydate" [options]="myDatePickerOptions"
                                          [(ngModel)]="startDate" ></my-date-picker>
                                      </div>
                                      <div class="col-sm-6" style="">
                                          <my-date-picker name="mydate" [options]="myDatePickerOptions"
                                          [(ngModel)]="endDate" ></my-date-picker>
                                      </div>
                                    </div>
                                    <button #onbottomsearchbtn  type="submit" class="btn btn-info" (click)="search()">
                                      <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                                    </button>
                                  </form>
                              </div>
                          </div>
                          <button #ontopsearchbtn  type="button" class="btn btn-info" (click)="search()">
                            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                          </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div> -->
              <!-- </div> -->
              <!-- NEW NK END  -->

            <!-- *********************** // THIS IS THE RIGHT  *********************** -->
            
            <!-- *********************** // PAGINATION // ***********************  -->
            <div class="row">
              <div class="col-md-12">
            <div class="tiledesk-pagination" style="margin-top: 10px; margin-right: 3px;  float: right">
              <div style="width: 120px;"  >
                <div class="input-group">

                  <!-- -------====== BTN DECREASE PAGE  ======------ -->
                  <span class="input-group-btn" style="padding-right:0px;  padding-left: 0px;">
                    <button [disabled]="pageNo + 1 === 1" class="btn btn-info" type="button" (click)="decreasePageNumber()" style="padding: 6px 8px">
                      <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    </button>
                  </span>

                  <!-- -------====== DISPLAY No PAGE / No TOTAL PAGES   ======------ -->
                  <span class="input-group-btn" style="padding-right:0px;">
                    <button #searchbtn class="btn btn-info" type="button" style="padding: 6px 8px">
                      {{ pageNo + 1 }} / {{ totalPagesNo_roundToUp }}
                    </button>
                  </span>
                  
                  <!-- -------====== BTN INCREASE PAGE  ======------ -->
                  <span class="input-group-btn" style="padding-right:0px">
                    <button [disabled]="pageNo + 1 === totalPagesNo_roundToUp" class="btn btn-info" type="button" (click)="increasePageNumber()" style="padding: 6px 8px">
                      <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    </button>
                  </span>

                </div>
             
              </div>
            </div>
            </div>
            </div>
                

            <form #myForm="ngForm" novalidate class="advancedOptionForm">
              <div class="row">
  
                <div class="input-group">

                  <!-- -------====== INPUT 'FULL TEXT' ======------ -->
                  <div class="buttonInside">
                    <input name="fullText" type="text" [(ngModel)]="fullText" class="form-control" 
                      placeholder="{{ 'HistoryPage.ContainsTheWords' | translate }}" style="margin-bottom: 20px; padding-bottom: 16px; padding-left: 6px;">
                    <span  *ngIf="fullText?.length > 0" class="glyphicon glyphicon-remove" aria-hidden="true" (click)="clearFullText()" ></span>
                  </div>
                    <span class="input-group-btn" style="padding-right:0px">
                      <button #searchbtn class="btn btn-info" type="button" (click)="search()">
                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                      </button>
                    </span>

                    <span class="input-group-btn" style="padding-left:0px; padding-right:0px">
                      <button #advancedoptionbtn class="btn btn-default" type="button" (click)="toggle()">
                        <span class="caret"></span>
                      </button>
                    </span>
                </div>

                <div *ngIf="show" @ngIfAnimation>
                  
                  <div @easeInOut>

                    <label  class="col-sm-12" style="text-align: left; color: rgba(0, 0, 0, 0.54); ">
                        {{ 'HistoryPage.FilterByDepartment' | translate }}
                    </label>
                    <div class="col-sm-12" style="margin-bottom: 20px;">
                      <ng-select name="dept" [(ngModel)]="selectedDeptId">
                        <ng-option *ngFor="let dept of departments" [value]="dept._id" >{{dept.name}}</ng-option>
                      </ng-select>
                    </div>

                    <label for="contain" class="col-sm-12" style="text-align: left; color: rgba(0, 0, 0, 0.54);">
                        {{ 'HistoryPage.DateRange' | translate }}
                    </label>
                    <div class="col-sm-6" >
                        <my-date-picker name="mydate" [options]="myDatePickerOptions" 
                        [(ngModel)]="startDate" ></my-date-picker>
                    </div>
                    <div class="col-sm-6" style="">
                        <my-date-picker name="mydate" [options]="myDatePickerOptions"
                        [(ngModel)]="endDate" ></my-date-picker>
                    </div>

                    <button #searchbtnbottom type="submit" class="btn btn-info" (click)="search()">
                      <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                    </button>

                    <button #clearsearchbtn type="submit" class="btn btn-white" (click)="clearSearch()">
                      <!-- <span class="glyphicon glyphicon-remo" aria-hidden="true"></span> -->
                      {{ 'HistoryPage.ClearSearch' | translate }}
                      
                    </button>

                  </div>
                </div>
              </div>
            </form>



          </div>  <!-- /.end card-header -->

          <loading-spinner *ngIf="showSpinner"></loading-spinner>
          <div  *ngIf="!showSpinner" class="card-content table-responsive">
 

            <table class="table table-hover">
              <thead class="text">
                <tr>
               
                  <th></th>
 
                  <!-- ===== REQUEST ID ===== -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong>
                        Id
                      </strong>
                    </span>  
                  </th> -->

                  <!-- ===== DEPARTMENT NAME ===== -->
                  <th>
                    <span style="color: #566787">
                      <strong>
                        <strong>{{ 'VisitorsPage.Department' | translate }}</strong>
                      </strong>
                    </span>  
                  </th>

                  <!-- ===== REQUESTER ===== -->
                  <th>
                    <span style="color: #566787">
                      <strong> 
                        {{ 'HistoryPage.Requester' | translate }}
                      </strong>
                    </span>
                  </th>

                  <!-- ===== REQUESTER ID * FOR DEBUG * ===== -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong> Requester Id </strong>
                    </span>
                  </th> -->

                  <!-- ===== REQUEST FIRST TEXT ===== -->
                  <th>
                    <span style="color: #566787">
                      <strong> 
                        {{ 'HistoryPage.Message' | translate }}
                      </strong>
                    </span>
                  </th>

                  <!-- ===== SERVED BY ===== -->
                  <th>
                    <span style="color: #566787">
                      <strong> 
                        {{ 'HistoryPage.ServedBy' | translate }}
                      </strong>
                    </span>
                  </th>
                   
                  <!-- ===== RATING ===== -->
                  <th>
                    <span style="color: #566787">
                      <strong> 
                        {{ 'HistoryPage.Rating' | translate }}
                      </strong>
                    </span>
                  </th>
 
                  <!-- ===== MEMBERS ===== -->
                  <!-- <th>
                    <span style="color: #566787">
                      <strong> Membri </strong>
                      </span>
                  </th> -->

                  <!-- ===== PUBLISHED ===== -->
                  <th>
                    <span style="color: #566787">
                      <strong> 
                      {{ 'HistoryPage.Published' | translate }}
                      </strong>
                    </span>
                  </th>
    
                </tr>
              </thead>

              <tbody>

                <!-- ===== IF THERE ISN'T HISTORY REQUEST ===== -->
                <tr *ngIf="requestList && requestList.length === 0"> 
                  <td colspan="7" style="text-align: center; padding-top: 16px; cursor: pointer">

                    <p style="font-size:1em; color:#999999; font-weight: 400">
                      {{ 'HistoryPage.NoRequests' | translate }}
                    </p>
                  </td>
                </tr> 
 
                 <tr *ngFor="let request of requestList">
                   
                  <td style="text-align:center">
 
                    <span (click)='goToRequestMsgs(request?.request_id)'>
                       <!-- pull-right -->
                       <button class="btn btn-default btn-visibility-custom">
                         <i style="font-size: 17px !important; " class="material-icons">visibility</i>
                       </button>
                    </span>
                     
                  </td>
                   
                  <!-- ===== REQUEST ID ===== -->
                   <!-- <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                     <p style="font-size:0.8em;" >
                       {{ request?.recipient }}
                     </p>
                  </td> -->

                  <!-- ===== DEPARTMENT NAME ===== -->
                  <td>
                      <p style="font-size:0.9em">
                        {{ request?.departmentid?.name }}
                      </p>
                  </td>

                  <!-- ===== REQUESTER FULL NAME ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" rel="tooltip" title="{{ request?.requester_id }}">
                    <p style="font-size:0.9em">
                      {{ request?.requester_fullname }}
                    </p>
                  </td>

                  <!-- ===== REQUESTER ID * FOR DEBUG * ===== -->
                  <!-- <td>
                    <p style="font-size:0.8em">
                      {{ request?.requester_id }}
                    </p>
                  </td> -->

                  <!-- ===== REQUEST FIRST TEXT ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                    <p style="font-size:0.9em;" [innerHTML]="getRequestText(request?.first_text)">
                    </p>
                  </td>
 
                  <!-- ===== SERVED BY ===== -->
                  <!-- <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" >
                    <span *ngFor="let m of request?.members_array"  style="font-size:0.8em;">
                      <span *ngIf="m !== request?.requester_id && m !== 'system' && m !== currentUserID"> 
                        <p class="member" (click)="goToMemberProfile( m )" [innerHTML]="members_replace( m )" style="padding-top:1px; padding-bottom:1px; cursor: pointer;">  </p>
                      </span> 
                      <p *ngIf="m === currentUserID" style="padding-top:1px; padding-bottom:1px;"> 
                        - <strong> 'ME' </strong>
                      </p>
                    </span>
                  </td> -->
                  <td></td>
 
                  <!-- ===== RATING ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer" >
                    <p *ngIf="request?.rating" style="font-size:0.8em;">
                        {{ request?.rating }} / 5
                    </p>
                    <p *ngIf="!request?.rating" style="font-size:0.8em;">
                        - / 5
                    </p>
                  </td>
 
                  <!-- ===== LIST OF MEMBERS ===== -->
                  <!-- <td (click)='openViewMsgsModal(request?.recipient)' style="cursor:pointer">
                    <p style="font-size:0.8em; min-width: 220px;"  [innerHTML]="request?.members_as_string"></p>
                  </td> -->

                  <!-- ===== PUBLISHED ===== -->
                  <td (click)='goToRequestMsgs(request?.request_id)' style="cursor:pointer">
                    <p style="font-size:0.9em">
                      <!-- {{ request?.timestamp | date: 'd/M/y HH:mm:ss'}} -->
                      <!-- {{ request?.request_date_fromnow }} -->
                      <!-- {{ request?.created_on | date: 'd/M/y HH:mm:ss' }} -->
                      {{ request?.createdAt | amTimeAgo }} ({{ request?.createdAt | date: 'd/M/y HH:mm:ss' }}) 
                    </p>
                  </td>

                </tr>
              </tbody>
            </table>
          </div> <!-- ./ card-content table-responsive -->

          <div class="card-footer" style="text-align:right">
            <div class="stats" >

              <div style="width: 120px; margin: 0 auto; margin-top: 10px " >
                <div class="input-group">

                  <!-- -------====== BTN DECREASE PAGE  ======------ -->
                  <span class="input-group-btn" style="padding-right:0px;  padding-left: 0px;">
                    <button [disabled]="pageNo + 1 === 1" class="btn btn-info" type="button" (click)="decreasePageNumber()" style="padding: 6px 8px">
                      <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    </button>
                  </span>

                  <!-- -------====== DISPLAY No PAGE / No TOTAL PAGES   ======------ -->
                  <span class="input-group-btn" style="padding-right:0px;">
                    <button #searchbtn class="btn btn-info" type="button" style="padding: 6px 8px">
                      {{ pageNo + 1 }} / {{ totalPagesNo_roundToUp }}
                    </button>
                  </span>
                  
                  <!-- -------====== BTN INCREASE PAGE  ======------ -->
                  <span class="input-group-btn" style="padding-right:0px">
                    <button [disabled]="pageNo + 1 === totalPagesNo_roundToUp" class="btn btn-info" type="button" (click)="increasePageNumber()" style="padding: 6px 8px">
                      <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    </button>
                  </span>

                </div>
              </div>
              
            </div>
          </div>

        </div> <!-- ./ card -->
      </div> <!-- ./ col-md-12 -->
    <div> <!-- ./ row -->
  
  </div> <!-- ./ container-fluid -->
</div> <!-- ./ main-content -->

  