<div class="panel-intent-content tds_draggable">


    <!-- <div class="sc-kOFvkO ivRJLM" style=" position: absolute; top: 0px; z-index: 10; right: -30px;">
        <div class="sc-crntcq oLzyR">
            <div class="vf-tooltip" 
            matTooltipClass="custom-mat-tooltip"
            matTooltip="Start test from here" 
            #tooltip="matTooltip" 
            matTooltipPosition='above' 
            matTooltipHideDelay="100">

                <span class="sc-ejWHKt vKQWr vf-svg-icon vf-svg-icon--play" size="16" color="#62778C"
                    style="transform: scale(1.2);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" style="position: relative;top: 12px;">
                        <path fill="currentColor"
                            d="M3 5.778c0-2.042 0-3.063.617-3.513a1.56 1.56 0 0 1 .339-.187c.713-.286 1.62.234 3.431 1.273l3.874 2.222c1.755 1.007 2.633 1.51 2.727 2.24.016.125.016.25 0 .373-.094.73-.972 1.234-2.727 2.24L7.387 12.65c-1.812 1.04-2.718 1.56-3.431 1.273a1.558 1.558 0 0 1-.339-.187C3 13.285 3 12.264 3 10.222V5.778Z">
                        </path>
                    </svg>
                </span>
            </div>
        </div>
    </div> -->

    <div class="test-intent-play-container" [ngClass]="{'test-intent-play-container-on-start': isStart}">

        <div *ngIf="listOfActions?.length > 0" class="test-intent-play">
            <span class="svg-icon--play" (click)="openTestSiteInPopupWindow()" matTooltipClass="custom-mat-tooltip"
                matTooltip="Start test from here" #tooltip="matTooltip" matTooltipPosition='above'
                matTooltipHideDelay="100">
                <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 24 24" width="28px" fill="#6c6859"
                    style="position: relative;top: 9px;">
                    <path d="M0 0h24v24H0z" fill="none" />
                    <path d="M8 5v14l11-7z" />
                </svg>
            </span>
        </div>

    </div>

    <div class="pic-header tds_draggable" [ngClass]="{'cds-start': isStart}">

        <!-- <div class="pic-header-title tds_draggable">
            <div class="pic-header-title-input tds_draggable">
                <div class="pic-title-text tds_draggable">
                    {{ intent.intent_display_name }}
                </div>
            </div>
        </div> -->

        <appdashboard-panel-intent-header class="pic-title-text tds_draggable" 
            [intentSelected]="intent">
        </appdashboard-panel-intent-header>


        <div *ngIf="!isStart" class="cds-intent-options">
            <div class="option" (click)="onSelectQuestion(HAS_SELECTED_TYPE.QUESTION)"
                [attr.active]="questionCount > 0">
                <img src="assets/cds/images/brain.svg" title="Question">
            </div>
            <div class="option" (click)="onSelectForm(HAS_SELECTED_TYPE.FORM)" [attr.active]="formSize > 0">
                <img src="assets/cds/images/form.svg" title="Form">
            </div>
        </div>
    </div>

    <div *ngIf="isStart" class="cds-start-content">
        <cds-action-intent class="panel-response" 
            [isStart]="isStart" 
            [intentSelected]="intent"
            [action]="listOfActions[0]"
            (updateAndSaveAction)="onUpdateAndSaveAction($event)">
        </cds-action-intent>
    </div>



    <div *ngIf="!isStart" class="drag-actions target-container" [cdkDropListData]="listOfActions" cdkDropList
        (cdkDropListDropped)="onDropAction($event)">
        <!-- [id]="'action_'+i" -->

        <!-- ---------------------------------------------- -->
        <!-- Add block placeholder -->
        <!-- ---------------------------------------------- -->
        <div #openActionMenuBtn class="add--action-placeholder" *ngIf="listOfActions?.length === 0"
            (click)="$event.stopPropagation();openActionMenu(intent, 'add-action-placeholder')">
            <div class="add--action-placeholder-add-icon">
                <span class="material-icons"> add </span>
            </div>
            <div class="add--action-placeholder-text">
                Add an action to this block
            </div>
        </div>

        <div *ngFor="let action of listOfActions; let i = index, let last = last;" cdkDrag
            (cdkDragStarted)="onDragStarted($event, intent.intent_id)" (cdkDragReleased)="onDragEnded($event)"
            [id]="action._tdActionId" class="box-action" tabindex="0" [ngClass]="{
            'cds-action-active': intentService.actionSelectedID === action._tdActionId, 
            'cds-no-featured-action': action._tdActionType !== TYPE_ACTION.REPLY,
            'cds-last-action': last
            }" (keydown)="onKeydown($event)" (click)="onSelectAction(action, i, action._tdActionId)">
            <!-- (keydown)="onDeleteAction($event)" -->

            <!-- <div cdkDragHandle class="header-action"> -->
            <!-- <div class="icon-action">
                    <img [src]="getActionParams(action).src" [title]="getActionParams(action).name" />
                </div>
                <span class="label-action">
                    <div class="sc-irCEUn gzQaYi vf-canvas__step-item-label">
                        {{ getActionParams(action).name }}
                    </div>
                </span>
               </div> -->
            
            <cds-action-description cdkDragHandle 
                class="header-action" 
                [elementType]="action._tdActionType">
            </cds-action-description>

            <div cdkDragDisabled class="body-action" [ngSwitch]="action._tdActionType">

                <cds-action-controls 
                    (onClickControl)="onClickControl($event, action, i)">
                </cds-action-controls>


                <cds-action-reply *ngSwitchCase="TYPE_ACTION.REPLY" 
                    class="panel-response" 
                    [intentSelected]="intent"
                    [connector]="connector" 
                    [action]="action" 
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-reply>

                <cds-action-reply *ngSwitchCase="TYPE_ACTION.RANDOM_REPLY" 
                    class="panel-response"
                    [intentSelected]="intent" 
                    [action]="action" 
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-reply>

                <cds-action-intent *ngSwitchCase="TYPE_ACTION.INTENT" 
                    class="panel-response" 
                    [intentSelected]="intent"
                    [action]="action" 
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-intent>

                <cds-action-change-department *ngSwitchCase="TYPE_ACTION.CHANGE_DEPARTMENT" 
                    class="panel-response"
                    [action]="action" 
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-change-department>
    

                <cds-action-email *ngSwitchCase="TYPE_ACTION.EMAIL" 
                    class="panel-response" 
                    [action]="action"
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-email>

                <cds-action-agent *ngSwitchCase="TYPE_ACTION.AGENT" 
                    class="panel-response" 
                    [action]="action"
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-agent>

                <cds-action-online-agents *ngSwitchCase="TYPE_ACTION.ONLINE_AGENTS" 
                    class="panel-response"
                    [connectorChanged]="connectorChanged" 
                    [intentSelected]="intent" 
                    [action]="action"
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-online-agents>

                <cds-action-open-hours *ngSwitchCase="TYPE_ACTION.OPEN_HOURS" 
                    class="panel-response"
                    [connectorChanged]="connectorChanged" 
                    [intentSelected]="intent" 
                    [action]="action"
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-open-hours>

                <cds-action-wait *ngSwitchCase="TYPE_ACTION.WAIT" 
                    class="panel-response" 
                    [action]="action"
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-wait>

                <cds-action-close *ngSwitchCase="TYPE_ACTION.CLOSE" 
                    [action]="action">
                </cds-action-close>

                <cds-action-json-condition *ngSwitchCase="TYPE_ACTION.JSON_CONDITION" 
                    class="panel-response"
                    [intentSelected]="intent" 
                    [action]="action" 
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-json-condition>

                <cds-action-replace-bot *ngSwitchCase="TYPE_ACTION.REPLACE_BOT" 
                    class="panel-response" 
                    [action]="action"
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-replace-bot>

                <cds-action-assign-variable *ngSwitchCase="TYPE_ACTION.ASSIGN_VARIABLE" 
                    class="panel-response"
                    [action]="action" 
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-assign-variable>

                <cds-action-delete-variable *ngSwitchCase="TYPE_ACTION.DELETE_VARIABLE" 
                    class="panel-response"
                    [action]="action">
                </cds-action-delete-variable>

                <cds-action-hide-message *ngSwitchCase="TYPE_ACTION.HIDE_MESSAGE" 
                    class="panel-response"
                    [action]="action" 
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-hide-message>
                
                <cds-action-web-request *ngSwitchCase="TYPE_ACTION.WEB_REQUEST" 
                    class="panel-response" 
                    [action]="action"
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-web-request>

                <cds-action-whatsapp-attribute *ngSwitchCase="TYPE_ACTION.WHATSAPP_ATTRIBUTE" 
                    class="panel-response"
                    [action]="action" 
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-whatsapp-attribute>

                <cds-action-whatsapp-static *ngSwitchCase="TYPE_ACTION.WHATSAPP_STATIC" 
                    class="panel-response"
                    [action]="action" 
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-whatsapp-static>

                <cds-action-askgpt *ngSwitchCase="TYPE_ACTION.ASKGPT" 
                    class="panel-response" 
                    [action]="action"
                    (updateAndSaveAction)="onUpdateAndSaveAction($event)">
                </cds-action-askgpt>

            </div>

            <cds-action-arrow *ngIf="!last"></cds-action-arrow>

            <div *ngIf="last" class="csd-open-action-menu-btn-wpr csd-add-action-btn-wpr-element">
                <button #openActionMenuBtn (click)="$event.stopPropagation();openActionMenu(intent, 'add-action-btn')"
                    class="btn cds-add-action-btn csd-add-action-btn-wpr-element">
                    <span class="material-icons csd-add-action-btn-wpr-element">
                        add
                    </span>
                </button>
            </div>

        </div>

    </div>

</div>