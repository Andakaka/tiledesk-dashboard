<div class="navbar-brand" style="z-index: -1;margin-top:10px; padding-left:30px">
  <i class="material-icons" style="vertical-align: middle !important; cursor: pointer;" (click)="goBack()">keyboard_arrow_left</i>
  <!-- Request  -->
  {{ "RequestMsgsPage.Request" | translate }}
  <code style="color:#3f87a6; border: 1px solid #cee9f9; font-size:0.8em"> {{cut_support_group_from_request_id(id_request)}} </code>
</div>

<div class="main-content" style="padding-top:0px">
  <div class="container-fluid">

    <loading-spinner *ngIf="showSpinner"></loading-spinner>
    <div *ngIf="!showSpinner" class="row is-flex">

      <div class="col-sm-7">
        <div class="card" style="padding-top:0px; padding-bottom:0px; padding-left:25px; padding-right:25px" >
            <h4 class="card-title" style="text-transform: none; color: #566787; font-weight:600; margin-top: 18px; margin-bottom: 0px; border-bottom: 1px solid #eeeeee; padding-bottom: 15px;">
                <!-- Request  -->
                {{ "RequestMsgsPage.MessagesOfTheRequest" | translate }}
                <code style="color: #566787; font-weight: 400" >{{cut_support_group_from_request_id(id_request)}} </code>
              </h4>
          <div #scrollMe class="card-content" style="height: 550px; overflow-y: auto;" (scroll)="onScroll($event)">

            <!-- OLD CHAT -->
            <!-- <div *ngFor="let message of messagesList" style="vertical-align:baseline">
              <div class="row">
                <div class="col-sm-11" style="padding-left: 0px; ">
                  <div class="msg_sender" style="padding-right: 0px">
                    <p style="font-size: 0.8em; margin-bottom:0px">
                      <strong> {{ message.sender_fullname }} </strong> 
                    </p>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-12">
                  <div class="talk-bubble tri-right left-top" style="margin-bottom: 12px; min-width: 450px;">
                    <div class="talktext">
                      <div class="col-xs-8">
                        <p style="padding: 10px; margin-bottom: 0px; font-size: 13px; font-family: Tahoma, Verdana, Segoe, sans-serif;">
                          {{ message.text }}
                        </p>
                      </div>
                      <div class="col-xs-4">
                        <span class="time-right" style="font-size: 11px; padding-right: 10px; padding-bottom: 5px; padding-top: 10px">
                          {{ message.timestamp | date: 'd/M/y HH:mm:ss'}}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div> -->

            <div class="chat-body" style="vertical-align:baseline">
              <div style="padding-bottom: 3px;" class="answer left" *ngFor="let message of messagesList">
                <div class="avatar" style="  width: 35px; height: 35px; position: absolute;">
                  <!-- <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="User name" style="display: block;border-radius: 20px; height: 100%; margin-top: 35px;"> -->
                  <div style="display: block;border-radius: 20px; height: 100%; margin-top: 35px; background-color: #ebebeb">
                    <span class="senderFullname" style="position: absolute; top:43px; margin-left:13px; color: #999999; text-transform: uppercase">
                      {{ messageSenderInitialLetter( message.sender_fullname )}}
                    </span>
                  </div>
  
                </div>
                <div class="name">
                  <strong>{{ message.sender_fullname }}</strong>
                </div>
                <div class="row">
  
                <div class="col-xs-11 text" style=" margin-left: 6px; vertical-align: middle; padding-top: 5px;padding-bottom: 5px;">
                  <!-- <div class="text"> -->
                        <!-- <div  style=" background: #ebebeb; height: 100%; float: right"> -->
                          <span class="messageTime" style=" float: right; padding-right: 0px; font-size: 11px; color:#aaa">
                              {{ message.timestamp | date: 'd/M/y HH:mm:ss'}}
                          </span>
                        <!-- </div> -->
                        <div class="col-xs-8 col-sm-8 col-lg-8" style=" padding-left: 5px; padding-top: 5px;">
                            <!-- min-width: 300px; -->
                          <div class="messageText" style="font-size: 13px; line-height: normal; ">
                              {{ message.text }}
                              
                          </div>
                        </div>
                  <!-- </div> -->


                </div>

                
                </div>
                <!-- <div class="time">5 min ago</div> -->
              </div>
            </div>
           
            <a id="fixed-button"  class="button" [ngStyle]="{'display':displayBtnScrollToBottom }" (click)="scrollToBottom()" >
              <span class="icon is-small">
                <i class="fa fa-chevron-down"></i>
              </span>
            </a>

          </div>

          <div class="card-footer" style="text-align: center; margin-bottom: 0px;padding-top: 2px;">
            <div class="stats">

              <!-- ENTER -->
              <span *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === true || IS_CURRENT_USER_JOINED === true">
                <a class="btn btn-info" role="button" right style="color: white;" 
                    target="_blank" href="{{ CHAT_BASE_URL }}?recipient={{id_request}}" 
                    style="padding:12px 16px !important;">   
                  <!-- Entra // changed the translation to 'Enter' in 'Open the chat' -->
                  <i class="material-icons" style="vertical-align: middle;  top:0px !important">open_in_new</i>
                 <span style="vertical-align: middle"> {{ 'RequestMsgsPage.OpenTheChat' | translate }}</span>
                </a>
              </span>

              <!-- JOIN BTN -->
              <span *ngIf="JOIN_TO_GROUP_HAS_ERROR === false 
                  && IS_CURRENT_USER_JOINED === false 
                  && SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === false 
                  && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false">
                <button class="btn btn-default" (click)="onJoinHandled()" style="padding:12px 16px !important;" [disabled]="request?.support_status == 1000" >
                  <!-- Join // changed the translation to 'Join' in 'Enter' -->
                  {{ 'RequestMsgsPage.Enter' | translate }}
                </button>
              </span>

              <!-- LOADING BTN -->
              <span *ngIf="SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === true 
                  && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false  
                  && JOIN_TO_GROUP_HAS_ERROR === false">
                <button class="btn btn-default" style="padding:12px 16px !important;" btn-block>
                  <i class="fa fa-spinner fa-spin"></i> 
                    <!-- Elaborazione -->
                    {{ 'RequestMsgsPage.Loading' | translate }}
                </button>
              </span>

              <!-- IF THE CALLBALL JOIN-TO-GROUP HAS ERROR SHOWS THE BTN ERROR (DISABLED)  -->
              <span *ngIf="JOIN_TO_GROUP_HAS_ERROR === true">
                <button class="btn btn-danger" disabled style="padding:12px 16px !important;">
                  <!-- Errore -->
                  {{ 'RequestMsgsPage.Error' | translate }}
                </button>
              </span>

            </div>
          </div>
        </div>  
        <!-- ./ card   -->
      </div>
      <!-- ./ col-md-7 -->

      <!-- // SIDEBAR // -->
      <div class="col-sm-5">
        <div class="card" style="padding-top:5px; padding-bottom:5px;">

          <div class="card-content" style="padding-top:5px;">
            <h4 class="card-title requestattibutestitle" style="text-transform: none; color: #566787; font-weight:600; margin-bottom: 16px; border-bottom: 1px solid #eeeeee; padding-bottom: 15px;">
              <!-- Request  -->
              <span class="requestattibutes">{{ "RequestMsgsPage.RequestAttributes" | translate }}</span>

              <!-- {{ request?.timestamp | amTimeAgo }} -->
              <!-- <span class="requestattibutestime" style="font-size: 14px; color:#999999; float: right;">
                  <i class="material-icons" style="vertical-align: middle">access_time</i>
                  <span style="vertical-align: middle; font-weight: 500">
                    {{ "RequestMsgsPage.Published" | translate }}: {{ request?.created_on | date: 'd/M/y HH:mm:ss' }}
                  </span>
              </span> -->
              
            </h4>

            <p style="margin-bottom: 10px"> 

              <!-- IF IS AN CLOSED REQUEST -->
              <span *ngIf="request?.support_status == 1000"> 
                <i style="font-size: 24px !important; vertical-align: middle; color: #999999" class="material-icons">visibility</i>
              
                <span style="vertical-align: middle; color: #999999">
                  <strong>
                    <!-- Request closed  -->
                    {{ "RequestMsgsPage.RequestClosed" | translate }}
                  </strong>
                </span>
              </span>

              <!-- IF IS AN UNSERVED REQUEST -->
                <span *ngIf="request?.support_status == 100"> 
                <i style="font-size: 24px !important; vertical-align: middle; color: #f44336" class="material-icons">visibility</i>
              
                <span style="vertical-align: middle; color: #f44336">
                  <strong>
                    <!-- Request unserved  -->
                    {{ "RequestMsgsPage.RequestUnserved" | translate }}
                  </strong>
                </span>
              </span>

              <!-- IF IS A SERVED REQUEST AND BETWEEN THE MEMBERS THERE IS THE CURRENT USER -->
              <span *ngIf="request?.support_status == 200 && request?.currentUserIsJoined === true"> 
                <i style="font-size: 24px !important; vertical-align: middle; color: #4CAF50" class="material-icons">visibility</i>
              
                <span style="vertical-align: middle; color: #4CAF50">
                  <strong>
                    <!-- Request served by:  -->
                    {{ "RequestMsgsPage.RequestServedBy" | translate }}
                  </strong>
                </span>

              </span>

              <span *ngIf="request?.support_status == 200 && !request?.currentUserIsJoined"> 
                <i style="font-size: 24px !important; vertical-align: middle; color: #00bcd4" class="material-icons">visibility</i>
              
                <span style="vertical-align: middle; color: #00bcd4;">
                  <strong>
                    <!-- Request served by:  -->
                    {{ "RequestMsgsPage.RequestServedBy" | translate }}
                  </strong>
                </span>
              </span>


              <span *ngFor="let m of members_array"  style="">
                <span *ngIf="m !== request?.requester_id && m !== 'system' && m !== currentUserID"> 
                  <span class="tag_member" (click)="goToMemberProfile( m )" [innerHTML]="members_replace( m )" style="cursor: pointer;"> 
                    
                  </span>
                </span> 
                <span *ngIf="m === currentUserID" style=""> 
                    <span class="tag_member_me"> ME </span>
                </span>
              </span>   
            </p>

            <!-- PUBLISHED -->
            <!-- <p style="margin-bottom: 3px; color:#566787; padding-top: 10px;"> 
              <strong>
                {{ "RequestMsgsPage.Published" | translate }}
               </strong>
            </p>
            <p style="color:#999999; font-weight: 500">  
              {{ request?.timestamp | amTimeAgo }}
            </p> -->

            <!-- PUBLISHED -->
            <p style="margin-bottom: 3px; color:#566787; padding-top: 10px;"> 
              <strong>
                {{ "RequestMsgsPage.Published" | translate }} 
              </strong>
            </p>
            <p style="color:#999999; font-weight: 500">  
              {{ request?.created_on | date: 'd/M/y HH:mm:ss' }}
            </p>
            
            <!-- REQUEST ID -->
            <p style="margin-bottom: 3px; color:#566787;"> 
              <strong>
                {{ "RequestMsgsPage.RequestId" | translate }}
                </strong>
            </p>
            <p style="color:#999999; font-weight: 500">  
                {{ id_request }}
            </p>

 
            <!-- <p style="margin-bottom: 3px; color:#566787"> 
              <strong>Request Id </strong>
            </p>
              <p style="color:#999999; font-weight: 500">    
              {{ id_request }}
            </p> -->
            

            <p style="margin-bottom: 3px; color:#566787"> 
              <strong>
                <!-- Requester  -->
                {{ "RequestMsgsPage.Requester" | translate }}
              </strong>
            </p>
            <p style="color:#999999; font-weight: 500">  
              {{ requester_fullname }} 
            </p>

            <p style="margin-bottom: 3px; color:#566787"> 
              <strong>
                <!-- Requester Id -->
                {{ "RequestMsgsPage.RequesterId" | translate }}
              </strong>
            </p>
            <p style="color:#999999; font-weight: 500">  
              {{ requester_id }}
            </p>

            <p style="margin-bottom: 3px; color:#566787"> 
              <strong>
                <!-- Chat form: user name -->
                {{ "RequestMsgsPage.ChatFormUserName" | translate }}
              </strong>
            </p>
            <p style="color:#999999; font-weight: 500">  
              {{ user_name }}
            </p>

            <p style="margin-bottom: 3px; color:#566787"> 
              <strong>
                <!-- Chat form: user email -->
                {{ "RequestMsgsPage.ChatFormUserEmail" | translate }}
              </strong>
            </p>
            <p style="color:#999999; font-weight: 500">  
              
              <a *ngIf="user_email !== 'n.a.'" href="mailto:{{user_email}}">{{ user_email }}</a>
              <a *ngIf="user_email === 'n.a.'" style="color:#999999;">{{ user_email }}</a>
            </p>

            <p style="margin-bottom: 3px; color:#566787"> 
              <strong>
                <!-- Department Name -->
                {{ "RequestMsgsPage.DepartmentName" | translate }}
              </strong>
            </p>
            <p style="color:#999999; font-weight: 500">  
              {{ department_name }}
            </p>

            <p style="margin-bottom: 3px; color:#566787"> 
              <strong>
                <!-- Department Id -->
                {{ "RequestMsgsPage.DepartmentId" | translate }}
              </strong>
            </p>
            <p style="color:#999999; font-weight: 500">  
              {{ department_id }}
            </p>

            <p style="margin-bottom: 3px; color:#566787"> 
              <strong>
                <!-- Source page -->
                {{ "RequestMsgsPage.SourcePage" | translate }}
              </strong>
            </p>
            <p style="color:#999999; word-wrap: break-word; font-weight: 500">  
              
              <a href="{{source_page}}" target="_blank">{{source_page}}</a>
            </p>

          </div>
        </div>

      </div>

    </div>
    <!-- ./ row -->

  </div>
</div>