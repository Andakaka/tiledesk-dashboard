<div class="navbar-brand" style="z-index: -1;margin-top:10px; padding-left:30px">
  <i class="material-icons" style="vertical-align: middle !important; cursor: pointer;" (click)="goBack()">keyboard_arrow_left</i>
  <!-- Request  -->
  {{ "RequestMsgsPage.RequestDetails" | translate }}
  <!-- <code style="color:#3f87a6; border: 1px solid #cee9f9; font-size:0.8em"> {{cut_support_group_from_request_id(id_request)}} </code> -->
</div>

<div class="main-content" style="padding-top:0px">
  <div class="container-fluid">

    <loading-spinner *ngIf="showSpinner"></loading-spinner>
    <div *ngIf="!showSpinner">
      <div class="row">
        <div class="col-sm-7 chat-col">
          <div class="card chat-card" style="padding-top:0px; padding-bottom:0px;">
            <div class="row" style="border-bottom: 1px solid #eeeeee; padding-left:25px; padding-right:25px">
              <div class="col-sm-12">
                <div class="two-div-wrapper">
                  <div style="float: left; width: 50%; ">
                    <h4 class="card-title" style="text-transform: none; color: #566787; font-weight:400; margin-top: 18px; margin-bottom: 0px; padding-bottom: 15px;">
                      {{ "RequestMsgsPage.Messages" | translate }}
                      <!-- <code style="color: #566787; font-weight: 400" >{{cut_support_group_from_request_id(id_request)}} </code> -->
                    </h4>
                  </div>
                  <div style="float: right; width: 50%; ">

                    <!-- -----------------============= ACTIONS DROPDOWN MENU =============----------------- -->
                    <div class="dropdown pull-right">
                      <a href="#" class="btn btn-info dropdown-toggle outline_btn" data-toggle="dropdown" style="padding:6px 15px; margin-top: 15px">
                          {{ 'VisitorsPage.Actions' | translate }}
                      <b class="caret"></b>
                      </a>
                      <ul class="dropdown-menu">
                        <li [ngClass]="{'disable-dropdown-menu-btn' : request?.support_status == 1000}">
                          <a (click)='openArchiveRequestModal(request?.recipient)' style="padding-left: 15px; padding-right: 15px;">
                            <i class="material-icons" style="padding-right: 5px;">close</i>
                            <span style="position: relative; top: 1px; cursor:pointer"> 
                            {{ 'RequestMsgsPage.CloseTheRequest' | translate }}  
                          </span>
                          </a>
                        </li>
                        <li class="divider"></li>
                        <li [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_AGENT === true}"> 
                          <a (click)='openSelectUsersModal()' style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">swap_horiz</i>
                              <span style="position: relative; top: 1px; cursor:pointer">
                                  {{ 'VisitorsPage.ReassignRequest' | translate }}
                              </span>
                          </a>
                        </li>
                        <li class="divider"></li>
                        <li [ngClass]="{'disable-dropdown-menu-btn' : IS_CURRENT_USER_JOINED === false}">
                            
                          <a (click)='openleaveChatModal()' style="padding-left: 15px; padding-right: 15px;">
                              <i class="material-icons" style="padding-right: 5px;">exit_to_app</i>
                            <span style="position: relative; top: 1px; cursor:pointer"> 
                              {{ 'VisitorsPage.LeaveChat' | translate }}
                            </span>
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
            </div>
          </div>
          <div #scrollMe class="card-content" style="height: 500px; overflow-y: auto; padding: 0px; padding-left:25px; padding-right:25px " (scroll)="onScroll($event)">
              <!-- OLD CHAT -->
              <!-- <div *ngFor="let message of messagesList" style="vertical-align:baseline">
                <div class="row">
                  <div class="col-sm-11" style="padding-left: 0px; ">
                    <div class="msg_sender" style="padding-right: 0px">
                      <p style="font-size: 0.8em; margin-bottom:0px">
                        <strong> {{ message.sender_fullname }} </strong> 
                      </p>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12">
                    <div class="talk-bubble tri-right left-top" style="margin-bottom: 12px; min-width: 450px;">
                      <div class="talktext">
                        <div class="col-xs-8">
                          <p style="padding: 10px; margin-bottom: 0px; font-size: 13px; font-family: Tahoma, Verdana, Segoe, sans-serif;">
                            {{ message.text }}
                          </p>
                        </div>
                        <div class="col-xs-4">
                          <span class="time-right" style="font-size: 11px; padding-right: 10px; padding-bottom: 5px; padding-top: 10px">
                            {{ message.timestamp | date: 'd/M/y HH:mm:ss'}}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div> -->

            <div class="chat-body" style="vertical-align:baseline">
              <div style="padding-bottom: 3px;" class="answer left" *ngFor="let message of messagesList">
                <div class="avatar" style="  width: 35px; height: 35px; position: absolute;">
                  <!-- <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="User name" style="display: block;border-radius: 20px; height: 100%; margin-top: 35px;"> -->
                  <div style="display: block;border-radius: 20px; height: 100%; margin-top: 35px; background-color: #ebebeb">
                    <span class="senderFullname" style="position: absolute; top:43px; margin-left:13px; color: #999999; text-transform: uppercase">
                      {{ messageSenderInitialLetter( message.sender_fullname )}}
                    </span>
                  </div>
    
                </div>
                <div class="name">
                  <strong>{{ message.sender_fullname }}</strong>
                </div>
                <div class="row">
    
                  <div class="col-xs-11 text" style=" margin-left: 6px; vertical-align: middle; padding-top: 5px;padding-bottom: 5px;">
                      <!-- <div class="text"> -->
                            <!-- <div  style=" background: #ebebeb; height: 100%; float: right"> -->
                    <span class="messageTime" style=" float: right; padding-right: 0px; font-size: 11px; color:#aaa">
                      {{ message.timestamp | date: 'd/M/y HH:mm:ss'}}
                    </span>
                      <!-- </div> -->
                    <div class="col-xs-8 col-sm-8 col-lg-8" style=" padding-left: 5px; padding-top: 5px;">
                        <!-- min-width: 300px; -->
                      <div class="messageText" style="font-size: 13px; line-height: normal; ">
                        {{ message.text }}
                      </div>
                    </div>
                      <!-- </div> -->
                  </div>
                </div>
                  <!-- <div class="time">5 min ago</div> -->
              </div>
            </div>
            
            <a id="fixed-button"  class="button" [ngStyle]="{'display':displayBtnScrollToBottom }" (click)="scrollToBottom()" >
              <span class="icon is-small">
                <i class="fa fa-chevron-down"></i>
              </span>
            </a>

          </div>

          <div class="card-footer" style="text-align: center; margin-bottom: 0px;padding-top: 2px; margin:auto">
            <div class="stats" style="width: 100%;">
  
              <!-- -------------------================== start new three btn ==================------------------- -->
              <div class="row" style="width: 100%">
                  
                <!-- -------------------====== CLOSE CHAT - MOVED IN DROPDOWN ======------------------- -->
                <!-- <div class="col-xs-4 col-sm-4 col-md-4" style="padding-right:5px">
                  <button type="button" class="btn btn-danger btn-block tooltipx"
                    (click)='openArchiveRequestModal(request?.recipient)' style="vertical-align: middle; padding-left: 0px;padding-right: 0px;" 
                    [disabled]="request?.support_status == 1000">
                      {{ 'RequestMsgsPage.Close' | translate }}
                    <span class="tooltiptext">{{ 'RequestMsgsPage.CloseTheRequest' | translate }}</span>
                  </button>
                </div> -->
                  
                <!-- ------------============ BTNS SWITCH: OPEN THE CHAT, ENTER, LOADING, ERROR ============------------ -->
                <!-- [disabled]="request?.support_status == 1000" -->
                <div class="col-xs-12" style="padding-left:5px; padding-right:5px"> 
                  
                  <div class="centered-buttons" style="width: 100%; padding: 0px 35px;">
                    <span *ngIf="HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === true || IS_CURRENT_USER_JOINED === true">
                      <button #openChatBtn (click)="openChatInNewWindow()" class="btn btn-info btn-block open_the_chat_btn" role="button" 
                      style="padding-left: 0px; padding-right: 0px" 
                      [ngClass]="{'disable_open_the_chat_btn' : request?.support_status == 1000}">   
                        
                        <i class="material-icons" style="vertical-align: middle;  top:0px !important; padding-bottom: 2px;">open_in_new</i>
                      <span style="vertical-align: middle"> {{ 'RequestMsgsPage.OpenTheChat' | translate }}</span>
                      </button>
                    </span>
      
                    <span *ngIf="JOIN_TO_GROUP_HAS_ERROR === false 
                        && IS_CURRENT_USER_JOINED === false 
                        && SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === false 
                        && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false">
                      <button class="btn btn-info btn-block" (click)="onJoinHandled()" 
                        style="padding-left: 0px;padding-right: 0px;" [disabled]="request?.support_status == 1000">
                        {{ 'RequestMsgsPage.Enter' | translate }}
                      </button>
                    </span>

                    <span *ngIf="SHOW_JOIN_TO_GROUP_SPINNER_PROCESSING === true 
                        && HAS_COMPLETED_JOIN_TO_GROUP_POST_REQUEST === false  
                        && JOIN_TO_GROUP_HAS_ERROR === false">
                      <button class="btn btn-default btn-block" style="padding-left: 0px;padding-right: 0px;" btn-block>
                        <i class="fa fa-spinner fa-spin" style="margin-right: 5px;"></i> 
                          {{ 'RequestMsgsPage.Loading' | translate }}
                      </button>
                    </span>
      
                    <span *ngIf="JOIN_TO_GROUP_HAS_ERROR === true">
                      <button class="btn btn-danger btn-block" disabled style="padding-left: 0px;padding-right: 0px;">
                        {{ 'RequestMsgsPage.Error' | translate }}
                      </button>
                    </span>
                  </div>

                  <!--  -------------------====== BTN REASSIGN REQUETS - MOVED IN DROPDOWN ======----------------- -->
                  <!-- <div class="col-xs-4 col-sm-4 col-md-4" style="padding-left:5px;">
                    <button type="button" class="btn btn-warning btn-block tooltipx"
                        (click)='openSelectUsersModal()' 
                        style="vertical-align: middle; padding-left: 0px;padding-right: 0px;" 
                        [disabled]="request?.support_status == 1000">
                        {{ 'VisitorsPage.Reassign' | translate }}
                      
                      <span class="tooltiptext" style="text-transform:none">
                        {{ 'VisitorsPage.ReassignRequest' | translate }}
                      </span>
                    </button>
                  </div> -->
                </div>
              </div> <!-- ./end ROW -->
              
            </div>

          </div>
          </div>  <!-- ./ card   -->
        </div> <!-- ./ col-md-7 -->

        <!-- // SIDEBAR // -->
        <div class="col-sm-5 right-col">
          <div class="card right-card" style="padding-top:5px; padding-bottom:5px;">

            <div class="card-content" style="padding-top:5px;">
              
              <h4 class="card-title requestattibutestitle" style="text-transform: none; color: #566787; 
                font-weight:400; margin-bottom: 8px; border-bottom: 1px solid #eeeeee; padding-bottom: 12px;">
                <!-- Request  -->
                <span class="requestattibutes">{{ "RequestMsgsPage.RequestAttributes" | translate }}</span>

                <!-- {{ request?.timestamp | amTimeAgo }} -->
                <!-- <span class="requestattibutestime" style="font-size: 14px; color:#999999; float: right;">
                    <i class="material-icons" style="vertical-align: middle">access_time</i>
                    <span style="vertical-align: middle; font-weight: 500">
                      {{ "RequestMsgsPage.Published" | translate }}: {{ request?.created_on | amTimeAgo }}
                    </span>
                </span> -->
                
              </h4>

              <p style="margin-bottom: 5px"> 

                <!-- IF IS AN CLOSED REQUEST -->
                <span *ngIf="request?.support_status == 1000"> 
                  <i style="font-size: 24px !important; vertical-align: middle; color: #999999" class="material-icons">visibility</i>
                
                  <span class="request-category" style="vertical-align: middle; color: #999999">
                    <!-- <strong> -->
                      <!-- Request closed  -->
                      <!-- - {{ "RequestMsgsPage.WasServedBy" | translate }} -->
                      {{ "RequestMsgsPage.RequestClosed" | translate }} 
                    <!-- </strong> -->
                  </span>
                </span>

                <!-- IF IS AN UNSERVED REQUEST -->
                  <span *ngIf="request?.support_status == 100"> 
                  <i style="font-size: 24px !important; vertical-align: middle; color: #f44336" class="material-icons">visibility</i>
                
                  <span class="request-category" style="vertical-align: middle; color: #f44336">
                    <!-- <strong> -->
                      <!-- Request unserved  -->
                      {{ "RequestMsgsPage.RequestUnserved" | translate }}
                    <!-- </strong> -->
                  </span>
                </span>

                <!-- IF IS A SERVED REQUEST AND BETWEEN THE MEMBERS THERE IS THE CURRENT USER -->
                <span *ngIf="request?.support_status == 200 && request?.currentUserIsJoined === true"> 
                  <i style="font-size: 24px !important; vertical-align: middle; color: #4CAF50" class="material-icons">visibility</i>
                
                  <span class="request-category" style="vertical-align: middle; color: #4CAF50">
                    <!-- <strong> -->
                      <!-- Request served by:  -->
                      {{ "RequestMsgsPage.RequestServedBy" | translate }}
                    <!-- </strong> -->
                  </span>

                </span>

                <span *ngIf="request?.support_status == 200 && !request?.currentUserIsJoined"> 
                  <i style="font-size: 24px !important; vertical-align: middle; color: #00bcd4" class="material-icons">visibility</i>
                
                  <span  class="request-category" style="vertical-align: middle; color: #00bcd4;">
                    <!-- <strong> -->
                      <!-- Request served by:  -->
                      {{ "RequestMsgsPage.RequestServedBy" | translate }}
                    <!-- </strong> -->
                  </span>
                </span>

                <!-- <span *ngFor="let m of members_array"  style="">
                  <span *ngIf="m !== request?.requester_id && m !== 'system' && m !== currentUserID"> 
                    <div class="tag_member" (click)="goToMemberProfile( m )" [innerHTML]="members_replace( m )" style="cursor: pointer;">  </div>
                  </span> 
                  <span *ngIf="m === currentUserID" style=""> 
                      <span class="tag_member_me"> ME </span>
                  </span>
                </span>    -->
              </p>

              <span class="row-body" style="">  
                  <span style="color:#394f5a;"> id: </span>  {{ id_request }}
              </span>

              <div class="row" style="margin-top:5px"> 
                <div class="col-sm-12" style="border-bottom: 1px solid #e1eef4; border-top: 1px solid #e1eef4;">
                  <p class="row-header" style=""> 
                      <!-- <i class="material-icons" style="vertical-align: middle">access_time</i>  -->
                    {{ "RequestMsgsPage.Published" | translate }}
                  </p>
        

              <!-- PUBLISHED (from now format) -->
              <!-- <p style="margin-bottom: 3px; color:#566787; padding-top: 10px;"> 
                <strong>
                  {{ "RequestMsgsPage.Published" | translate }}
                </strong>
              </p>
              <p style="color:#999999; font-weight: 500">  
                {{ request?.timestamp | amTimeAgo }}
              </p> -->

              <!-- ============ PUBLICATION DATE ============ -->
              <!-- <p style="margin-bottom: 3px; color:#566787; padding-top: 10px;"> 
                <strong>
                  {{ "RequestMsgsPage.Date" | translate }} 
                </strong>
              </p> -->
              
              <!-- color:#394f5a; font-weight: 400; font-size: 12px -->
              <span class="row-body" >  
                  
                  {{ request?.created_on | amTimeAgo }} ({{ request?.created_on | date: 'd/M/y HH:mm:ss' }})
              </span>

            </div>
          </div>
                
              <div class="row" style="margin-top:15px"> 
                <div class="col-sm-12" style="border-bottom: 1px solid #e1eef4; border-top: 1px solid #e1eef4;">
                  <p class="row-header" style=""> 
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                    <span style="vertical-align: middle"> 
                        {{ "RequestMsgsPage.Agents" | translate }} 
                     </span>
                  </p>
  

              <div class="served_by">
                 
                <span *ngIf="agents_array?.length === 0" class="row-body">
                  {{ "RequestMsgsPage.NoAgent" | translate }} 
                </span>
                <div *ngFor="let agent of agents_array" class="row-body"> 

                  <span (click)="goToMemberProfile( agent?._id )" style="cursor:pointer">
                    <img *ngIf="agent.isBot === false" style="vertical-align: middle; width: 23px; height: 23x; border-radius: 50%; border: 1px solid #eee; margin-right: 8px;" 
                    class="user-img" src="https://firebasestorage.googleapis.com/v0/b/chat-v2-dev.appspot.com/o/profiles%2F{{agent?._id}}%2Fphoto.jpg?alt=media" 
                    onerror="this.src='assets/img/no_image_user.png'"/>

                    <img *ngIf="agent.isBot === true" style="vertical-align: middle; width: 23px; height: 23px; border-radius: 50%; border: 1px solid #eee; margin-right: 8px;" 
                    class="user-img" src="assets/img/bot_image.png" 
                    onerror="this.src='assets/img/no_image_user.png'"/>

                    <span [ngClass]="{'current_user_is_agent' : agent?._id === currentUserID}" style="font-size:12px; font-weight: 400"> 
                      {{agent?.firstname}} {{agent?.lastname}} 
                    </span> 
                  </span>

                </div>
              </div>

            </div>
          </div>

              <!-- REQUEST ID -->
              <!-- <p style="margin-bottom: 3px; color:#566787;"> 
                <strong>
                  {{ "RequestMsgsPage.RequestId" | translate }}
                  </strong>
              </p>
              <p style="color:#999999; font-weight: 500">  
                  {{ id_request }}
              </p> -->
  
              <!-- ========== Requester  ========== -->
              <!-- <p style="margin-bottom: 3px; color:#566787"> 
                <strong>
                  {{ "RequestMsgsPage.Requester" | translate }}
                </strong>
              </p> -->

              <div class="row" style="margin-top:15px"> 
                <div class="col-sm-12" style="border-bottom: 1px solid #e1eef4; border-top: 1px solid #e1eef4;">
                  <p class="row-header" style=""> 
                      <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                    <span style="vertical-align: middle"> 
                        {{ "RequestMsgsPage.Requester" | translate }}
                      </span>
                  </p>
                    <!-- style="color:#999999; font-weight: 500" -->
                  <p class="row-body" style="margin-bottom:0px; padding-bottom:0px">  
                 
                    <!-- // REQUESTER FULLNAME  -->
                    <span class="requester-avatar-wrapper"> 
                      <span class="_requester-avatar" [ngStyle]="{'background-color': fillColour }" [ngClass]="{'requester_fullname-undefined' : !requester_fullname}">
                        <span style="color: #ffffff"> {{ requester_fullname_initial }} </span>
                      </span>
                      <span *ngIf="REQUESTER_IS_VERIFIED === true" class="tooltipx"> 
                        <svg version="1.1" id="Livello_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                            viewBox="0 0 26.6 26.6" width="18" height="18" style="position: relative;left: -11px;top: 12px;" xml:space="preserve">
                            <style type="text/css">
                              .st0{fill:none;}
                              .st1{fill:#FFFFFF;}
                              .st2{fill:#18BDF7;}
                            </style>
                            <path class="st0" d="M1.3,1.3h24v24h-24V1.3z"/>
                            <path class="st1" d="M13.3,0L2.4,4.9v7.3c0,6.7,4.6,13,10.9,14.5c6.2-1.5,10.9-7.8,10.9-14.5V4.9L13.3,0z"/>
                            <path class="st2" d="M13.3,2.3l-9,4v6c0,5.5,3.8,10.7,9,12c5.2-1.3,9-6.5,9-12v-6L13.3,2.3z M11.3,18.3l-4-4l1.4-1.4l2.6,2.6
                              l6.6-6.6l1.4,1.4L11.3,18.3z"/>
                          </svg>

                        <span class="tooltiptext"> {{ "VisitorsPage.AuthenticatedUser" | translate }} </span>
                      
                      </span>
                    </span>

                    <!-- <span style="color:#394f5a;"> {{ "RequestMsgsPage.RequesterName" | translate }}: </span>  -->
                    <span [ngClass]="{'requester-verified' : REQUESTER_IS_VERIFIED === true}" style="margin-left: 8px;"> 
                      {{ requester_fullname }} 
                    </span>
                    <span *ngIf="!requester_fullname" style="position: relative;left: -13px;">
                      n.a.
                    </span>
                  </p>
               

                  <p class="row-body" style="margin-bottom:0px; padding-bottom:0px"> 
                    <span style="color:#394f5a;"> {{ "RequestMsgsPage.ChatFormUserName" | translate }}: </span> 
                    {{  user_name }}
                  </p>

                  <p class="row-body" style="margin-bottom:0px;padding-bottom:0px"> 
                    <span style="color:#394f5a;"> {{ "RequestMsgsPage.ChatFormUserEmail" | translate }}: </span> 
                    <a *ngIf="user_email !== 'n.a.'" href="mailto:{{user_email}}">{{ user_email }}</a>
                    <a *ngIf="user_email === 'n.a.'" style="color:#999999;">{{ user_email }}</a>
                  </p>

                  <p class="row-body" style="margin-bottom:0px; padding-bottom:0px"> 
                    <!-- {{ "RequestMsgsPage.RequesterId" | translate }}: -->
                    <span style="color:#394f5a;"> id: </span> 
                      {{ requester_id }} 
                  </p>

                </div>
              </div>

              <div class="row" style="margin-top:15px"> 
                  <div class="col-sm-12" style="border-bottom: 1px solid #e1eef4; border-top: 1px solid #e1eef4;">
                    <p class="row-header" style=""> 
                        <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle"> 
                          {{ "RequestMsgsPage.DepartmentName" | translate }}: <span style="color: #7695a5; " > {{ department_name }}</span>
                       </span>
                    </p>
                    <!-- <span class="row-body">  
                  
                        {{ department_name }}
                    </span> -->
                </div>
              </div>

              <div class="row" style="margin-top:15px"> 
                  <div class="col-sm-12" style="border-bottom: 1px solid #e1eef4; border-top: 1px solid #e1eef4;">
                    <p class="row-header" style=""> 
                        <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle"> 
                          {{ "RequestMsgsPage.Rating" | translate }}: <span style="color: #7695a5; " > {{ rating }}</span>
                       </span>
                    </p>
                    <!-- <p class="row-body"  style="margin-bottom:0px">  
                        <span style="color:#394f5a;"> {{ "RequestMsgsPage.Rating" | translate }}: </span>
                        {{ rating }}
                    </p> -->

                    <p class="row-body"  style="margin-bottom:0px">  
                  
                        <span style="color:#394f5a;">  {{ "RequestMsgsPage.RatingMessage" | translate }}: </span>
                        {{ rating_message }}
                    </p>
                </div>
              </div>

              <div class="row" style="margin-top:15px"> 
                  <div class="col-sm-12" style="border-top: 1px solid #e1eef4;">
                    <p class="row-header" style=""> 
                        <!-- <i class="material-icons" style="vertical-align: middle"> group  </i>  -->
                      <span style="vertical-align: middle"> 
                          {{ "RequestMsgsPage.SourcePage" | translate }}
                       </span>
                    </p>
                    <p class="row-body"  style="margin-bottom:0px; word-wrap: break-word;">  
                  
                        <a href="{{source_page}}" target="_blank">{{source_page}}</a>
                    </p>

                </div>
              </div>


              <!-- <p style="margin-bottom: 3px; color:#566787"> 
                <strong>
                  {{ "RequestMsgsPage.RequesterId" | translate }}
                </strong>
              </p>
              <p style="color:#999999; font-weight: 500">  
                {{ requester_id }}
              </p> -->

              <!-- <p style="margin-bottom: 3px; color:#566787"> 
                <strong>
                   {{ "RequestMsgsPage.ChatFormUserName" | translate }}
                </strong>
              </p>
              <p style="color:#999999; font-weight: 500">  
                {{ user_name }}
              </p> -->

              <!-- <p style="margin-bottom: 3px; color:#566787"> 
                <strong>
                  {{ "RequestMsgsPage.ChatFormUserEmail" | translate }}
                </strong>
              </p>
              <p style="color:#999999; font-weight: 500">  
                
                <a *ngIf="user_email !== 'n.a.'" href="mailto:{{user_email}}">{{ user_email }}</a>
                <a *ngIf="user_email === 'n.a.'" style="color:#999999;">{{ user_email }}</a>
              </p> -->

              <!-- Department Name -->
              <!-- <p style="margin-bottom: 3px; color:#566787"> 
                <strong>
                  {{ "RequestMsgsPage.DepartmentName" | translate }}
                </strong>
              </p>
              <p style="color:#999999; font-weight: 500">  
                {{ department_name }}
              </p> -->

              <!-- RATING -->
              <!-- <p style="margin-bottom: 3px; color:#566787"> 
                <strong>
                    {{ "RequestMsgsPage.Rating" | translate }}
                </strong>
              </p>
              <p style="color:#999999; font-weight: 500">  
                {{ rating }}
              </p> -->

              <!-- RATING MESSAGE -->
              <!-- <p style="margin-bottom: 3px; color:#566787"> 
                <strong>
                    {{ "RequestMsgsPage.RatingMessage" | translate }}
                </strong>
              </p>
              <p style="color:#999999; font-weight: 500">  
                {{ rating_message }}
              </p> -->

              <!-- ========== Department Id ========== -->
              <!-- <p style="margin-bottom: 3px; color:#566787"> 
                <strong>
                  {{ "RequestMsgsPage.DepartmentId" | translate }}
                </strong>
              </p>
              <p style="color:#999999; font-weight: 500">  
                {{ department_id }}
              </p> -->

              <!-- <p style="margin-bottom: 3px; color:#566787"> 
                <strong>
                   {{ "RequestMsgsPage.SourcePage" | translate }}
                </strong>
              </p>
              <p style="color:#999999; word-wrap: break-word; font-weight: 500">  
                
                <a href="{{source_page}}" target="_blank">{{source_page}}</a>
              </p> -->

            </div>
          </div>
        </div>
      </div> <!-- ./ row -->
    </div>
    
  </div> <!-- ./ container fluid -->
</div>

<!-- ------------============= USERS LIST MODAL - FULL WIDTH MODAL =============------------ -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayUsersListModal , 'height': users_list_modal_height}" 
  style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog modal-lg users-list-modal" role="document" style="width: 100%; height: 100%; margin:0; padding: 0;">
    <div class="modal-content" style="height: auto; min-height: 100%; border-radius: 0; border:none;">
      
      <div class="modal-header">
          <!-- class="close" -->
        <button type="button" style="border: none !important; float: right" aria-label="Close" (click)="closeSelectUsersModal()">
          <span aria-hidden="true" style="font-size:31px; color: rgb(60, 72, 88) !important;">&times;</span>
        </button>

        <h4 class="modal-title">
          <div class="title-wrapper" style="max-width: 936px; margin:auto">
            {{ "VisitorsPage.ReassignRequest" | translate }}
          </div>
        </h4>
      </div>

      <div class="modal-body" style="padding-right: 15px; padding-top:15px; padding-bottom:15px; max-width: 936px; margin:auto ">
        
        <!-- ------------============ image inside a text field ============------------ -->
        <!-- <div class="row">
          <div class="col-sm-12" style="padding-left: 0px;">
            <h5 style="margin-bottom: 0px;">
              Reassign the request to the user
            </h5>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-8">
            <div class="fake-input">
              <input name="requester_email" type="email"  class="" autocomplete="off"
              placeholder="" style="margin-top:8px; height: 45px; width: 100%; border-radius: 4px; border-color: #ccc; border-width:1px; border-style:solid; padding-left: 6px;">
              <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;"> {{ userfirstname_selected }} {{ userlastname_selected }}</p>
              <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                {{ useremail_selected }}
              </span>
              <img *ngIf="userid_selected" src="https://firebasestorage.googleapis.com/v0/b/chat-v2-dev.appspot.com/o/profiles%2F{{userid_selected}}%2Fphoto.jpg?alt=media" width=25 
              onerror="this.src='assets/img/no_image_user.png'"/>
            </div>
          </div>

          <div class="col-sm-4">
            <button class="btn btn-info" (click)="reassignRequest(userid_selected)">
              SWAP USER
            </button>
          </div>
        </div> -->

        <div class="row">
          <div class="col-md-12">
             <h4 style="font-weight:400"> {{ "VisitorsPage.SelectTheUserToWhom" | translate }} </h4>
          </div>
          <div class="col-md-12">
            
            <div class="card" style="margin-top:5px; margin-bottom:5px">

              <loading-spinner *ngIf="showSpinner_inModalUserList"></loading-spinner>

              <div *ngIf="!showSpinner_inModalUserList" class="card-content table-responsive">

                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th colspan="2">
                        <span style="color: #566787">
                          <strong>
                            {{ "UsersPage.User" | translate }}
                          </strong>
                        </span>
                      </th>

                      <th>
                        <span style="color: #566787">
                          <strong>
                            {{ "UsersPage.Role" | translate }}
                          </strong>
                        </span>
                      </th>

                      <!-- <th>
                        <span style="color: #566787">
                          <strong>
                            Email
                          </strong>
                        </span>
                      </th> -->

                      <th *ngIf="!isMobile"></th>
                    </tr>
                  </thead>
                  <tbody>

                      <!-- <tr *ngIf="requestListServed.length === 0 && requestListUnserved.length === 0"> 
                          <td colspan="3" style="text-align: center; padding-top: 16px; cursor: pointer">
                          
                          </td>
                        </tr> -->
                      <!--  -->
                      <!-- let isFirstRow=first" [ngClass]="{'RowHeaderCSS' : isFirstRow}" (mouseover)="mouseOvered($event) -->
                    <tr *ngFor="let projectUser of projectUsersList;" class="table-row">
                      <!-- FOR DEBUG: ID OF THE PROJECT-USER  -->
                      <!-- <td>
                        {{ projectUser?._id }}
                      </td> -->
                      <!-- (mouseover)="mouseOvered=true" [class.btn-success]="mouseOvered" -->

                      <td *ngIf="projectUser?.id_user._id !== currentUserID" style="width: 25px; cursor:pointer" (click)= "selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        <img style="vertical-align: middle; width: 42px; height: 42px; border-radius: 50%; border: 1px solid #eee; margin-right: 15px;" 
                        class="user-img" src="https://firebasestorage.googleapis.com/v0/b/chat-v2-dev.appspot.com/o/profiles%2F{{projectUser?.id_user?._id}}%2Fphoto.jpg?alt=media" 
                        onerror="this.src='assets/img/no_image_user.png'"/>
                      </td>

                      <td *ngIf="projectUser?.id_user._id !== currentUserID" style="cursor:pointer" (click)= "selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;"> 
                          {{ projectUser?.id_user?.firstname }}
                          <span style="text-transform: uppercase"> 
                            {{ projectUser?.id_user?.lastname }} 
                          </span>
                        </p>
                        <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                            {{ projectUser?.id_user?.email }}
                        </span>
                      </td>

                      <td *ngIf="projectUser?.id_user._id !== currentUserID" style="cursor:pointer" (click)= "selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)" >
                        {{ projectUser?.role }}
                      </td>

                      <!-- <td>
                        {{ projectUser?.id_user?.email }}
                      </td> -->

                      <td *ngIf="projectUser?.id_user._id !== currentUserID && !isMobile" style="cursor:pointer" (click)= "selectUser(projectUser?.id_user._id, projectUser?.id_user.firstname, projectUser?.id_user.lastname, projectUser?.id_user?.email)">
                        <!-- <span class="tooltipx"> -->
                        <div class="assign-request">
                          <!-- <i class="material-icons" style="cursor: pointer">
                            swap_horiz
                          </i> -->
                          <p style="color: #00bcd4 ;margin-bottom:0px; font-size:12px; font-weight: 500;">{{ 'VisitorsPage.ReassignTo' | translate}} </p>
                          <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">{{ projectUser?.id_user?.email }} </span> 
                        </div>
                       
                          <!-- <span class="tooltiptext">
                            {{ "VisitorsPage.ReassignRequestTo" | translate }} {{ projectUser?.id_user?.email }}
                          </span>
                        </span> -->
                     
                      </td>
  
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      </div >  <!-- /. modal-body -->

      <!-- <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-info" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="onCloseUsersListModalHandler()" style="padding:12px 16px;">
            {{ "VisitorsPage.Continue" | translate }}
        </button>
      </div> -->
    </div> <!-- /.modal-content -->
  </div> <!-- /.modal-dialog -->
</div>

<!-- ============= CONFIRM REQUEST REASSIGNMENT MODAL ============= -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayConfirmReassignmentModal}" style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header" style="padding-bottom:15px">
        <button type="button" class="close" aria-label="Close" (click)="closeConfirmReassignmentModal()">
          <span aria-hidden="true" style="">&times;</span>
        </button>
        <h4 class="modal-title" style="color: #00bcd4">
          <i class="material-icons" style="vertical-align: middle">info</i>
            <span style="vertical-align: middle; padding-left:8px">
              {{ "VisitorsPage.ReassignRequest" | translate }}
            </span>
        </h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-sm-10">
            <h4 style="color: #566787;padding-top: 0px;font-size: 1.1em;font-weight: 500;margin-top: 0px;margin-bottom: 0px;">
              {{ "VisitorsPage.TheRequestWillBeReassignedTo" | translate }} 
            </h4>

            <table class="table" style="margin-bottom: 0px;">
              <tbody>
                <tr>
                  <td style=" border-top-width: 0px; width: 25px;">
                    <img *ngIf="userid_selected" src="https://firebasestorage.googleapis.com/v0/b/chat-v2-dev.appspot.com/o/profiles%2F{{userid_selected}}%2Fphoto.jpg?alt=media" 
                      width=35 onerror="this.src='assets/img/no_image_user.png'"/>
                  </td>
                  <td  style=" border-top-width: 0px;">
                    <p style="font-size:14px; line-height:21px; font-weight: 500; margin-bottom: 0px;"> 
                      {{ userfirstname_selected }} 
                      <span style="text-transform: uppercase"> 
                        {{ userlastname_selected }}
                      </span>
                    </p>
                    <span style="color: #7695a5; font-weight: 400; line-height:18px; font-size:12px">
                      {{ useremail_selected }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="margin-top: 0px;">
        <button class="btn btn-white" (click)="closeConfirmReassignmentModal()" style="padding:12px 16px;">
          {{ "VisitorsPage.Cancel" | translate }}
        </button>
        <button style="margin-top:0px" class="btn btn-info" (click)="reassignRequest(userid_selected)" style="padding:12px 16px;">
          {{ "VisitorsPage.ReassignRequest" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>


<!-- ============= ARCHIVIVE REQUEST MODAL ============= -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayArchiveRequestModal}" style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
        <!-- background-color:#ff5252; -->
      <div class="modal-header" style="padding-bottom:15px">
        <button type="button" class="close" aria-label="Close" (click)="onCloseArchiveRequestModal()">
            <!-- color: #fff -->
          <span aria-hidden="true" style="">&times;</span>
        </button>
        <h4 class="modal-title" style="color: #f44336">
            <i class="material-icons" style="vertical-align: middle">info</i>
            <span style="vertical-align: middle; padding-left:8px">
              <!-- Elimina richiesta -->
              {{ "VisitorsPage.ArchiveRequest" | translate }}
            </span>
        </h4>
        <!-- padding-left: 36px  -->
        <h4 class="modal-title" 
        style="color: #566787; padding-top:10px; font-size: 1.1em; font-weight: 500">
          <!-- La richiesta con ID: <code>{{ id_request_to_delete }}</code> verrà eliminata -->
          {{ "VisitorsPage.TheRequestWithId" | translate }} 
          <code style="color: #566787">
            {{ id_request_to_archive }}
          </code> 
          {{ "VisitorsPage.WillBeArchived" | translate }} 
        </h4>
      </div>
      <div class="modal-body">
          <p style="font-weight:400; text-align: left; margin-top: 10px; color: #566787">
            <!-- Sei sicuro di voler rimuovere la richiesta selezionata? -->
            {{ "VisitorsPage.AreYouSure" | translate }} <br>
            <span style="font-weight:100; color: #999; font-size:12px"> 
              <em>
                {{ "VisitorsPage.Note" | translate }}
              </em>
            </span> 
          </p>

      </div>
      <div class="modal-footer" style="margin-top: 0px;">
        <button class="btn btn-white" (click)="onCloseArchiveRequestModal()" style="padding:12px 16px;">
          <!-- Annulla -->
          {{ "VisitorsPage.Cancel" | translate }}
        </button>
        <button style="margin-top:0px" class="btn btn-danger" (click)="archiveTheRequestHandler()" style="padding:12px 16px;">
          <!-- Archivia Richiesta -->
          {{ "VisitorsPage.ArchiveRequest" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ============ INFO MODAL: ARCHIVING REQUEST IN PROGRESS ============ -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayArchivingInfoModal}" style="background-color: rgba(90,90,90,0.5);">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" aria-label="Close" (click)="onCloseArchivingInfoModal()">
          <span aria-hidden="true">&times;</span>
        </button>

        <h4 class="modal-title">
            {{ "VisitorsPage.ArchiveRequest" | translate }}
          <!-- <code>{{id_toDelete}}</code> -->
        </h4>
      </div>

      <div class="modal-body" style="padding-right: 15px; padding-top:15px; padding-bottom:15px">
      
        <span *ngIf="SHOW_CIRCULAR_SPINNER">
          <div  class="loader" style="top:25%;">
            <svg class="circular" viewBox="25 25 50 50">
              <circle class="path" cx="50" cy="50" r="15" fill="none" stroke-width="2" stroke-miterlimit="10"/>
            </svg>

          </div>
          <p style="margin-top: 60px; text-align: center; color: #566787; font-weight: 500">
              {{ "VisitorsPage.Processing" | translate }}
          </p>
        </span>

        <span *ngIf="!SHOW_CIRCULAR_SPINNER && !ARCHIVE_REQUEST_ERROR ">
            
          <div style="text-align: center">
            <i class="material-icons" style="color:#70b665">done</i>
            <p style="color:#70b665; font-weight: 500">
                {{ "VisitorsPage.Completed" | translate }}
            </p> 

          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
              {{ "VisitorsPage.RequestArchived" | translate }}
          </p>
        </span>

        <!-- IF THERE IS AN ERROR -->
        <span *ngIf="!SHOW_CIRCULAR_SPINNER && ARCHIVE_REQUEST_ERROR ">
          
          <div style="text-align: center ">
            <i class="material-icons" style="color:#ff5252">report_problem</i>
            <p style="color:#ff5252; font-weight: 500">
                {{ "VisitorsPage.Error" | translate }}
            </p> 

          </div>
          <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
              {{ "VisitorsPage.AnErrorHasOccurred" | translate }}
          </p>
        </span>
      </div>

      <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-info" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="onCloseArchivingInfoModal()" style="padding:12px 16px;">
            {{ "VisitorsPage.Continue" | translate }}
        </button>
      </div>

    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>

<!-- ============= LEAVE CHAT MODAL ============= -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayLeaveChatModal}" style="background-color: rgba(90,90,90,0.5);">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
          <!-- background-color:#ff5252; -->
        <div class="modal-header" style="padding-bottom:15px">
          <button type="button" class="close" aria-label="Close" (click)="closeLeaveChatModal()">
              <!-- color: #fff -->
            <span aria-hidden="true" style="">&times;</span>
          </button>
          <h4 class="modal-title" style="color: #f44336">
              <i class="material-icons" style="vertical-align: middle">info</i>
              <span style="vertical-align: middle; padding-left:8px">
                {{ "VisitorsPage.LeaveChat" | translate }}
              </span>
          </h4>
        </div>
        <div class="modal-body">
            <p style="font-weight:400; text-align: left; margin-top: 10px; color: #566787">

              {{ "VisitorsPage.AreYouSureLeftTheChat" | translate }} <br>
             </p>
  
        </div>
        <div class="modal-footer" style="margin-top: 0px;">
          <button class="btn btn-white" (click)="closeLeaveChatModal()" style="padding:12px 16px;">
            <!-- Annulla -->
            {{ "VisitorsPage.Cancel" | translate }}
          </button>
          <button style="margin-top:0px" class="btn btn-danger" (click)="leaveChat()" style="padding:12px 16px;">
            <!-- Archivia Richiesta -->
            {{ "VisitorsPage.LeaveChat" | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ============ INFO MODAL: LEAVING CHAT IN PROGRESS ============ -->
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': displayLeavingChatInfoModal}" style="background-color: rgba(90,90,90,0.5);">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" aria-label="Close" (click)="closeLeavingChatInfoModal()">
            <span aria-hidden="true">&times;</span>
          </button>
  
          <h4 class="modal-title">
              {{ "VisitorsPage.LeaveChat" | translate }}
 
          </h4>
        </div>
  
        <div class="modal-body" style="padding-right: 15px; padding-top:15px; padding-bottom:15px">
        
          <span *ngIf="SHOW_CIRCULAR_SPINNER">
            <div  class="loader" style="top:25%;">
              <svg class="circular" viewBox="25 25 50 50">
                <circle class="path" cx="50" cy="50" r="15" fill="none" stroke-width="2" stroke-miterlimit="10"/>
              </svg>
  
            </div>
            <p style="margin-top: 60px; text-align: center; color: #566787; font-weight: 500">
                {{ "VisitorsPage.Processing" | translate }}
            </p>
          </span>
  
          <span *ngIf="!SHOW_CIRCULAR_SPINNER && !LEAVE_CHAT_ERROR ">
              
            <div style="text-align: center">
              <i class="material-icons" style="color:#70b665">done</i>
              <p style="color:#70b665; font-weight: 500">
                  {{ "VisitorsPage.Completed" | translate }}
              </p> 
  
            </div>
            <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
                {{ "VisitorsPage.ChatLeft" | translate }}
            </p>
          </span>
  
          <!-- IF THERE IS AN ERROR -->
          <span *ngIf="!SHOW_CIRCULAR_SPINNER && LEAVE_CHAT_ERROR">
            
            <div style="text-align: center ">
              <i class="material-icons" style="color:#ff5252">report_problem</i>
              <p style="color:#ff5252; font-weight: 500">
                  {{ "VisitorsPage.Error" | translate }}
              </p> 
  
            </div>
            <p style="margin-top:10px; text-align: center; color: #566787; font-weight: 500">
                {{ "VisitorsPage.AnErrorHasOccurredLeavingTheChat" | translate }}
            </p>
          </span>
        </div>
  
        <div class="modal-footer" style="text-align: center;">
          <button class="btn btn-info" [disabled]="SHOW_CIRCULAR_SPINNER" (click)="closeLeavingChatInfoModal()" style="padding:12px 16px;">
            {{ "VisitorsPage.Continue" | translate }}
          </button>
        </div>
  
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>